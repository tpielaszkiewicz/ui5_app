/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/Device","sap/ui/core/LocaleData","sap/ui/core/delegate/ItemNavigation","sap/ui/unified/library","sap/ui/core/Locale","./MonthPickerRenderer","sap/ui/thirdparty/jquery","sap/ui/events/KeyCodes"],function(t,e,a,i,s,o,n,r,h){"use strict";var l=12,f={OneYearBackward:-1,OneYearForward:1};var g=t.extend("sap.ui.unified.calendar.MonthPicker",{metadata:{library:"sap.ui.unified",properties:{month:{type:"int",group:"Data",defaultValue:0},months:{type:"int",group:"Appearance",defaultValue:12},columns:{type:"int",group:"Appearance",defaultValue:3},primaryCalendarType:{type:"sap.ui.core.CalendarType",group:"Appearance"}},events:{select:{},pageChange:{}}}});g.prototype.init=function(){var t=sap.ui.getCore().getConfiguration().getCalendarType();this.setProperty("primaryCalendarType",t);this._iMinMonth=0;this._iMaxMonth=11};g.prototype.onAfterRendering=function(){c.call(this);_.call(this)};g.prototype.setMonth=function(t){this.setProperty("month",t,true);t=this.getProperty("month");if(t<0||t>11){throw new Error("Property month must be between 0 and 11; "+this)}if(this.getDomRef()){if(this.getMonths()<12){var e=this.getStartMonth();if(t>=e&&t<=e+this.getMonths()-1){v.call(this,t,true);this._oItemNavigation.focusItem(t-e)}else{M.call(this,t)}}else{v.call(this,t,true);this._oItemNavigation.focusItem(t)}}return this};g.prototype._getLocale=function(){var t=this.getParent();if(t&&t._getLocale){return t._getLocale()}else if(!this._sLocale){this._sLocale=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale().toString()}return this._sLocale};g.prototype._getLocaleData=function(){var t=this.getParent();if(t&&t._getLocaleData){return t._getLocaleData()}else if(!this._oLocaleData){var e=this._getLocale();var i=new o(e);this._oLocaleData=a.getInstance(i)}return this._oLocaleData};g.prototype.onsapspace=function(t){t.preventDefault()};g.prototype.onsapselect=function(t){var e=this._oItemNavigation.getFocusedIndex();var a=e+this.getStartMonth();if(a>=this._iMinMonth&&a<=this._iMaxMonth){v.call(this,a);this.fireSelect()}};g.prototype.onmousedown=function(t){this._oMousedownPosition={clientX:t.clientX,clientY:t.clientY}};g.prototype.onmouseup=function(t){if(this._bMousedownChange){this._bMousedownChange=false;this.fireSelect()}else if(e.support.touch&&this._isValueInThreshold(this._oMousedownPosition.clientX,t.clientX,10)&&this._isValueInThreshold(this._oMousedownPosition.clientY,t.clientY,10)){var a=this._oItemNavigation.getFocusedIndex();var i=a+this.getStartMonth();v.call(this,i);this.fireSelect()}};g.prototype.onThemeChanged=function(){if(this._bNoThemeChange){return}if(!this.getDomRef()){return}var t=this._oItemNavigation.getItemDomRefs(),e=this._getLocaleData(),a=e.getMonthsStandAlone("wide",this.getPrimaryCalendarType()),i,s;this._bNamesLengthChecked=undefined;this._bLongMonth=false;for(i=0;i<t.length;i++){s=r(t[i]);s.text(a[i])}_.call(this)};g.prototype.nextPage=function(){var t=this.getStartMonth(),e=this._oItemNavigation.getFocusedIndex(),a=e+t,i=this.getMonths();a=a+i;if(a>l-1){a=l-1}M.call(this,a);return this};g.prototype.previousPage=function(){var t=this.getStartMonth(),e=this._oItemNavigation.getFocusedIndex(),a=e+t,i=this.getMonths();a=a-i;if(a<0){a=0}M.call(this,a);return this};g.prototype.setMinMax=function(t,e){if(t==this._iMinMonth&&e==this._iMaxMonth){return this}t=parseInt(t);if(isNaN(t)||t<0||t>11){t=0}e=parseInt(e);if(isNaN(e)||e<0||e>11){e=11}if(t<=e){this._iMinMonth=t;this._iMaxMonth=e}else{this._iMaxMonth=t;this._iMinMonth=e}if(this.getDomRef()){var a=this._oItemNavigation.getItemDomRefs();var i=this.getId().length+2;for(var s=0;s<a.length;s++){var o=r(a[s]);var n=parseInt(o.attr("id").slice(i));if(n<this._iMinMonth||n>this._iMaxMonth){o.addClass("sapUiCalItemDsbl");o.attr("aria-disabled",true)}else{o.removeClass("sapUiCalItemDsbl");o.removeAttr("aria-disabled")}}}return this};g.prototype.getStartMonth=function(){if(this.getMonths()<l){var t=this._oItemNavigation.getItemDomRefs()[0];return parseInt(t.id.slice(this.getId().length+2))}else{return 0}};g.prototype._isValueInThreshold=function(t,e,a){var i=t-a,s=t+a;return e>=i&&e<=s};g.prototype.ontouchstart=function(t){if(!e.system.desktop&&t.target.classList.contains("sapUiCalItem")){t.target.classList.add("sapUiCalItemSel")}};function c(){var t=this.getDomRef(),e=this.$().find(".sapUiCalItem"),a=this.getColumns();if(!this._oItemNavigation){this._oItemNavigation=new i;this._oItemNavigation.attachEvent(i.Events.AfterFocus,u,this);this._oItemNavigation.attachEvent(i.Events.FocusAgain,d,this);this._oItemNavigation.attachEvent(i.Events.BorderReached,m,this);this.addDelegate(this._oItemNavigation);this._oItemNavigation.setHomeEndColumnMode(true,true);this._oItemNavigation.setDisabledModifiers({sapnext:["alt","meta"],sapprevious:["alt","meta"],saphome:["alt","meta"],sapend:["meta"]})}this._oItemNavigation.setRootDomRef(t);this._oItemNavigation.setItemDomRefs(e);this._oItemNavigation.setCycling(false);this._oItemNavigation.setColumns(a,true);var s=this.getMonth()-this.getStartMonth();this._oItemNavigation.setFocusedIndex(s);this._oItemNavigation.setPageSize(e.length)}function u(t){var e=t.getParameter("index"),a=t.getParameter("event");if(!a){return}if(a.type=="mousedown"){p.call(this,a,e)}}function d(t){var e=t.getParameter("index");var a=t.getParameter("event");if(!a){return}if(a.type=="mousedown"){p.call(this,a,e)}}function p(t,a){if(t.button||e.support.touch){return}var i=a+this.getStartMonth();if(i>=this._iMinMonth&&i<=this._iMaxMonth){v.call(this,i);this._bMousedownChange=true}t.preventDefault();t.setMark("cancelAutoClose")}function m(t){var e=t.getParameter("event");if(e.type){var a=this._oItemNavigation.getFocusedIndex()+this.getStartMonth(),i=this.getMonths(),s=this.getColumns();switch(e.type){case"sapnext":case"sapnextmodifiers":if(e.keyCode===h.ARROW_DOWN&&s<=i){if(a<l-i){M.call(this,a+s,false,f.OneYearForward)}else if(i===l){this.firePageChange({offset:f.OneYearForward});this._oItemNavigation.focusItem(a%s)}else{M.call(this,a%s,true,f.OneYearForward)}}else{if(a<l-i){M.call(this,a+1,false,f.OneYearForward)}else if(i===l){this.firePageChange({offset:f.OneYearForward});this._oItemNavigation.focusItem(0)}else{M.call(this,0,true,f.OneYearForward)}}break;case"sapprevious":case"sappreviousmodifiers":if(e.keyCode===h.ARROW_UP&&s<=i){if(a>=i){M.call(this,a-s,false,f.OneYearBackward)}else if(i===l){this.firePageChange({offset:f.OneYearBackward});this._oItemNavigation.focusItem(i-s+a)}else{M.call(this,l-s+a,true,f.OneYearBackward)}}else{if(a>=i){M.call(this,a-1,false,f.OneYearBackward)}else if(i===l){this.firePageChange({offset:f.OneYearBackward});this._oItemNavigation.focusItem(i-1)}else{M.call(this,l-1,true,f.OneYearBackward)}}break;case"sappagedown":if(a<l-i){M.call(this,a+i,false,f.OneYearForward)}else if(i===l){this.firePageChange({offset:f.OneYearForward})}else{M.call(this,a,true,f.OneYearForward)}break;case"sappageup":if(a>i){M.call(this,a-i,false,f.OneYearBackward)}else if(i===l){this.firePageChange({offset:f.OneYearBackward})}else{M.call(this,a,true,f.OneYearBackward)}break;default:break}}}function v(t,e){var a=this._oItemNavigation.getItemDomRefs(),i,s=this.getId()+"-m"+t,o;for(o=0;o<a.length;o++){i=r(a[o]);if(i.attr("id")==s){i.addClass("sapUiCalItemSel");i.attr("aria-selected","true")}else{i.removeClass("sapUiCalItemSel");i.attr("aria-selected","false")}}if(!e){this.setProperty("month",t,true)}}function _(){if(!this._bNamesLengthChecked){var t=0,e=this._oItemNavigation.getItemDomRefs(),a=false,i=this.getMonths(),s=Math.ceil(l/i),o=i-1;for(var n=0;n<s;n++){if(i<l){M.call(this,o);o=o+i;if(o>l-1){o=l-1}}for(t=0;t<e.length;t++){var h=e[t];if(Math.abs(h.clientWidth-h.scrollWidth)>1){a=true;break}}if(a){break}}if(i<l){o=this.getMonth();M.call(this,o)}if(a){this._bLongMonth=false;var f=this._getLocaleData(),g=this.getPrimaryCalendarType(),c=f.getMonthsStandAlone("abbreviated",g),u=f.getMonthsStandAlone("wide",g);for(t=0;t<e.length;t++){var d=r(e[t]);d.text(c[t]);d.attr("aria-label",u[t])}}else{this._bLongMonth=true}this._bNamesLengthChecked=true}}function M(t,e,a){var i=this._oItemNavigation.getItemDomRefs(),s=i.length,o=Math.floor(t/s)*s;if(o+s>l){o=l-s}var n=this._getLocaleData(),h=[],f=[],g=this.getPrimaryCalendarType();if(this._bLongMonth||!this._bNamesLengthChecked){h=n.getMonthsStandAlone("wide",g)}else{h=n.getMonthsStandAlone("abbreviated",g);f=n.getMonthsStandAlone("wide",g)}for(var c=0;c<i.length;c++){var u=c+o,d=r(i[c]);d.text(h[c+o]);d.attr("id",this.getId()+"-m"+(c+o));if(!this._bLongMonth){d.attr("aria-label",f[c+o])}if(u===this.getMonth()){d.addClass("sapUiCalItemSel");d.attr("aria-selected","true")}else{d.removeClass("sapUiCalItemSel");d.attr("aria-selected","false")}if(u<this._iMinMonth||u>this._iMaxMonth){d.addClass("sapUiCalItemDsbl");d.attr("aria-disabled",true)}else{d.removeClass("sapUiCalItemDsbl");d.removeAttr("aria-disabled")}}this._oItemNavigation.focusItem(t-o);if(e){this.firePageChange({offset:a})}}return g});