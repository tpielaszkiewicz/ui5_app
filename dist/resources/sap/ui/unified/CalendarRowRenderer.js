/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/date/UniversalDate","sap/ui/unified/CalendarAppointment","sap/ui/unified/CalendarLegendRenderer","sap/ui/Device","sap/ui/unified/library","sap/ui/core/InvisibleText","sap/base/Log"],function(e,a,t,n,r,i,s){"use strict";var l=r.CalendarDayType;var p=r.CalendarIntervalType;var o=r.CalendarAppointmentVisualization;var d={apiVersion:2};d.render=function(e,a){var t=a.getTooltip_AsString();var r=a.getAppointmentsVisualization();var i=this.getLegendItems(a);e.openStart("div",a);e.class("sapUiCalendarRow");if(!n.system.phone&&a.getAppointmentsReducedHeight()){e.class("sapUiCalendarRowAppsRedHeight")}if(r!=o.Standard){e.class("sapUiCalendarRowVis"+r)}if(t){e.attr("title",t)}var s=a.getWidth();if(s){e.style("width",s)}var l=a.getHeight();if(l){e.style("height",l)}e.accessibilityState(a);e.openEnd();this.renderAppointmentsRow(e,a,i);e.close("div")};d.renderAppointmentsRow=function(e,a,t){var n=a.getId();e.openStart("div",n+"-Apps");e.class("sapUiCalendarRowApps");e.openEnd();this.renderBeforeAppointments(e,a);this.renderAppointments(e,a,t);this.renderAfterAppointments(e,a);e.close("div")};d.renderBeforeAppointments=function(e,a){};d.renderAfterAppointments=function(e,a){};d.renderResizeHandle=function(e,a,t){};d.renderAppointments=function(a,t,n){var r=t._getVisibleAppointments();var i=t._getVisibleIntervalHeaders();var s=t._getStartDate();var l=[];var o=0;var d=0;var c=[];var g=0;var v=0;var f=t.getIntervals();var u=t.getIntervalType();var C=100/f;var A=0;var T=new e(s);var h=false;var I=false;switch(u){case p.Hour:l=t.getNonWorkingHours()||[];o=s.getUTCHours();d=24;break;case p.Day:case p.Week:case p.OneMonth:l=t._getNonWorkingDays();o=s.getUTCDay();d=7;c=t.getNonWorkingHours()||[];g=s.getUTCHours();v=24;break;case p.Month:c=t._getNonWorkingDays();g=s.getUTCDay();v=7;break;default:break}if(t._isOneMonthsRowOnSmallSizes()){this.renderSingleDayInterval(a,t,r,n,i,l,o,d,c,g,v,true,true)}else{for(A=0;A<f;A++){if(I){h=true}else{h=false}I=false;switch(u){case p.Hour:T.setUTCHours(T.getUTCHours()+1);if(T.getUTCHours()==0){I=true}break;case p.Day:case p.Week:case p.OneMonth:T.setUTCDate(T.getUTCDate()+1);if(T.getUTCDate()==1){I=true}break;case p.Month:T.setUTCMonth(T.getUTCMonth()+1);if(T.getUTCMonth()==0){I=true}break;default:break}this.renderInterval(a,t,A,C,i,l,o,d,c,g,v,h,I)}this.renderIntervalHeaders(a,t,C,i,f);a.openStart("div",t.getId()+"-Now");a.class("sapUiCalendarRowNow");a.openEnd();a.close("div");for(A=0;A<r.length;A++){var U=r[A];this.renderAppointment(a,t,U,n)}a.openStart("div",t.getId()+"-DummyApp");a.class("sapUiCalendarApp");a.class("sapUiCalendarAppTitleOnly");a.class("sapUiCalendarAppDummy");a.openEnd();a.close("div")}};d.writeCustomAttributes=function(e,a){};d.renderInterval=function(a,t,n,r,i,s,l,o,d,c,g,v,f){var u=t.getId()+"-AppsInt"+n;var C;var A=t.getShowIntervalHeaders()&&(t.getShowEmptyIntervalHeaders()||i.length>0);var T=t.getStartDate().getMonth();var h=new Date(t.getStartDate().getFullYear(),T+1,0).getDate();a.openStart("div",u);a.class("sapUiCalendarRowAppsInt");a.style("width",r+"%");if(n>=h&&t.getIntervalType()===p.OneMonth){a.class("sapUiCalItemOtherMonth")}for(C=0;C<s.length;C++){if((n+l)%o==s[C]){a.class("sapUiCalendarRowAppsNoWork");break}}if(!A){a.class("sapUiCalendarRowAppsIntNoHead")}if(v){a.class("sapUiCalendarRowAppsIntFirst")}if(f){a.class("sapUiCalendarRowAppsIntLast")}this.writeCustomAttributes(a,t);a.openEnd();if(A){a.openStart("div");a.class("sapUiCalendarRowAppsIntHead");a.openEnd();a.close("div")}if(t.getShowSubIntervals()){var I=t.getIntervalType();var U=0;switch(I){case p.Hour:U=4;break;case p.Day:case p.Week:case p.OneMonth:U=24;break;case p.Month:var b=t._getStartDate();var w=new e(b);w.setUTCMonth(w.getUTCMonth()+n+1,0);U=w.getUTCDate();w.setUTCDate(1);l=w.getUTCDay();break;default:break}var y=100/U;for(C=0;C<U;C++){a.openStart("div");a.class("sapUiCalendarRowAppsSubInt");a.style("width",y+"%");for(var S=0;S<d.length;S++){if((C+c)%g==d[S]){a.class("sapUiCalendarRowAppsNoWork");break}}a.openEnd();a.close("div")}}a.close("div")};d.renderIntervalHeaders=function(e,a,t,n,r){var i=a.getShowIntervalHeaders()&&(a.getShowEmptyIntervalHeaders()||n.length>0);if(i){for(var s=0;s<n.length;s++){var l=n[s],p,o;if(a._bRTL){o=t*l.interval;p=t*(r-l.last-1)}else{p=t*l.interval;o=t*(r-l.last-1)}this.renderIntervalHeader(e,a,l,a._bRTL,p,o)}}};d.renderIntervalHeader=function(e,a,t,n,r,i){var s=t.appointment.getId();var p=a._calculateAppoitnmentVisualCue(t.appointment);e.openStart("div",t.appointment);e.class("sapUiCalendarRowAppsIntHead");if(r!==undefined){e.style("left",r+"%")}if(i!==undefined){e.style("right",i+"%")}e.class("sapUiCalendarRowAppsIntHeadFirst");if(t.appointment.getSelected()){e.class("sapUiCalendarRowAppsIntHeadSel")}if(t.appointment.getTentative()){e.class("sapUiCalendarRowAppsIntHeadTent")}var o=t.appointment.getTooltip_AsString();if(o){e.attr("title",o)}var d=t.appointment.getType();var c=t.appointment.getColor();if(!c&&d&&d!=l.None){e.class("sapUiCalendarRowAppsIntHead"+d)}if(c){if(n){e.style("border-right-color",c)}else{e.style("border-left-color",c)}}e.openEnd();e.openStart("div");e.class("sapUiCalendarIntervalHeaderCont");if(c){e.style("background-color",t.appointment._getCSSColorForBackground(c))}e.openEnd();if(p.appTimeUnitsDifRowStart>0){e.icon("sap-icon://arrow-left",["sapUiCalendarAppArrowIconLeft"],{title:null})}var g=t.appointment.getIcon();if(g){var v=["sapUiCalendarRowAppsIntHeadIcon"];var f={};f["id"]=s+"-Icon";f["title"]=null;e.icon(g,v,f)}var u=t.appointment.getTitle();if(u){e.openStart("span",s+"-Title");e.class("sapUiCalendarRowAppsIntHeadTitle");e.openEnd();e.text(u);e.close("span")}var C=t.appointment.getText();if(C){e.openStart("span",s+"-Text");e.class("sapUiCalendarRowAppsIntHeadText");e.openEnd();e.text(C);e.close("span")}if(p.appTimeUnitsDifRowEnd>0){e.icon("sap-icon://arrow-right",["sapUiCalendarAppArrowIconRight"],{title:null})}e.close("div");e.close("div")};d.renderAppointment=function(e,a,t,n,r){var s=t.appointment;var p=s.getTooltip_AsString();var d=s.getType();var c=s.getColor();var g=s.getTitle();var v=s.getText();var f=s.getIcon();var u=s.getId();var C={labelledby:{value:i.getStaticId("sap.ui.unified","APPOINTMENT")+" "+u+"-Descr",append:true},selected:null};var A=a.getAriaLabelledBy();var T=a._calculateAppoitnmentVisualCue(s);if(A.length>0){C["labelledby"].value=C["labelledby"].value+" "+A.join(" ")}if(g){C["labelledby"].value=C["labelledby"].value+" "+u+"-Title"}if(v){C["labelledby"].value=C["labelledby"].value+" "+u+"-Text"}e.openStart("div",s);e.class("sapUiCalendarApp");if(s.getSelected()){e.class("sapUiCalendarAppSel");C["labelledby"].value=C["labelledby"].value+" "+i.getStaticId("sap.ui.unified","APPOINTMENT_SELECTED")}if(s.getTentative()){e.class("sapUiCalendarAppTent");C["labelledby"].value=C["labelledby"].value+" "+i.getStaticId("sap.ui.unified","APPOINTMENT_TENTATIVE")}if(!v){e.class("sapUiCalendarAppTitleOnly")}if(f){e.class("sapUiCalendarAppWithIcon")}if(!r){if(a._bRTL){e.style("right",t.begin+"%");e.style("left",t.end+"%")}else{e.style("left",t.begin+"%");e.style("right",t.end+"%")}}e.attr("data-sap-level",t.level);if(a._sFocusedAppointmentId==u){e.attr("tabindex","0")}else{e.attr("tabindex","-1")}if(p){e.attr("title",p)}if(!c&&d&&d!=l.None){e.class("sapUiCalendarApp"+d)}if(c){if(a._bRTL){e.style("border-right-color",c)}else{e.style("border-left-color",c)}}e.accessibilityState(s,C);e.openEnd();e.openStart("div");e.class("sapUiCalendarAppCont");if(c&&a.getAppointmentsVisualization()===o.Filled){e.style("background-color",s._getCSSColorForBackground(c))}e.openEnd();if(T.appTimeUnitsDifRowStart>0){e.icon("sap-icon://arrow-left",["sapUiCalendarAppArrowIconLeft"],{title:null})}if(f){var h=["sapUiCalendarAppIcon"];var I={};I["id"]=u+"-Icon";I["title"]=null;e.icon(f,h,I)}e.openStart("div");e.class("sapUiCalendarAppTitleWrapper");e.openEnd();if(g){e.openStart("span",u+"-Title");e.class("sapUiCalendarAppTitle");e.openEnd();e.text(g);e.close("span")}if(v){e.openStart("span",u+"-Text");e.class("sapUiCalendarAppText");e.openEnd();e.text(v);e.close("span")}e.close("div");if(T.appTimeUnitsDifRowEnd>0){e.icon("sap-icon://arrow-right",["sapUiCalendarAppArrowIconRight"],{title:null})}var U=a._oRb.getText("CALENDAR_START_TIME")+": "+a._oFormatAria.format(s.getStartDate());U=U+"; "+a._oRb.getText("CALENDAR_END_TIME")+": "+a._oFormatAria.format(s.getEndDate());if(d&&d!=l.None){U=U+"; "+this.getAriaTextForType(d,n)}e.openStart("span",u+"-Descr");e.class("sapUiInvisibleText");e.openEnd();e.text(U);e.close("span");e.close("div");this.renderResizeHandle(e,a,s);e.close("div")};d.renderSingleDayInterval=function(t,n,r,i,s,l,o,d,c,g,v,f,u){var C=1,A=100,T=n.getId()+"-AppsInt"+C,h,I=n.getShowIntervalHeaders()&&(n.getShowEmptyIntervalHeaders()||s.length>0),U=n.getStartDate(),b=U.getMonth(),w=new Date(U.getFullYear(),b+1,0).getDate(),y,S=n._getPlanningCalendar(),m=r.concat(n.getIntervalHeaders().filter(function(e){var a=e.getStartDate().getTime(),t=e.getEndDate().getTime(),n=U.getTime(),r=n+1e3*60*60*24;return!(a>=r||t<=n)}).map(function(e){return{appointment:e,isHeader:true}})).sort(a._getComparer(U)),R,D=[];if(S){D=S._getSelectedDates()}t.openStart("div",T);t.class("sapUiCalendarRowAppsInt");t.class("sapUiCalendarMonthRowAppsS");t.style("width",A+"%");if(C>=w&&n.getIntervalType()===p.OneMonth){t.class("sapUiCalItemOtherMonth")}for(h=0;h<l.length;h++){if((C+o)%d==l[h]){t.class("sapUiCalendarRowAppsNoWork");break}}if(!I){t.class("sapUiCalendarRowAppsIntNoHead")}if(f){t.class("sapUiCalendarRowAppsIntFirst")}if(u){t.class("sapUiCalendarRowAppsIntLast")}t.openEnd();if(I){t.openStart("div");t.class("sapUiCalendarRowAppsIntHead");t.openEnd();t.close("div")}if(D.length>0){for(h=0;h<m.length;h++){R=m[h];t.openStart("div");t.class("sapUiCalendarAppContainer");t.openEnd();t.openStart("div");t.class("sapUiCalendarAppContainerLeft");t.openEnd();t.openStart("div");t.openEnd();t.text(R.appointment._getDateRangeIntersectionText(U));t.close("div");t.close("div");t.openStart("div");t.class("sapUiCalendarAppContainerRight");t.openEnd();if(R.isHeader){this.renderIntervalHeader(t,n,R)}else{this.renderAppointment(t,n,R,i,true)}t.close("div");t.close("div")}}if(r.length===0||D.length===0){t.openStart("div");t.class("sapUiCalendarNoApps");t.openEnd();y=sap.ui.getCore().getLibraryResourceBundle("sap.m").getText("PLANNINGCALENDAR_ROW_NO_APPOINTMENTS");t.text(y);t.close("div")}t.openStart("div",n.getId()+"-Now");t.class("sapUiCalendarRowNow");t.openEnd();t.close("div");t.openStart("div",n.getId()+"-DummyApp");t.class("sapUiCalendarApp");t.class("sapUiCalendarAppTitleOnly");t.class("sapUiCalendarAppDummy");t.style("margin","0");t.style("height","0px");t.openEnd();t.close("div");if(n.getShowSubIntervals()){var E=n.getIntervalType();var H=0;switch(E){case p.Hour:H=4;break;case p.Day:case p.Week:case p.OneMonth:H=24;break;case p.Month:var k=new e(U);k.setUTCMonth(k.getUTCMonth()+C+1,0);H=k.getUTCDate();k.setUTCDate(1);o=k.getUTCDay();break;default:break}var _=100/H;for(h=0;h<H;h++){t.openStart("div");t.class("sapUiCalendarRowAppsSubInt");t.style("width",_+"%");for(var N=0;N<c.length;N++){if((h+g)%v==c[N]){t.class("sapUiCalendarRowAppsNoWork");break}}t.openEnd();t.close("div")}}t.close("div")};d.getLegendItems=function(e){var a=[],t,n=e.getLegend();if(n){t=sap.ui.getCore().byId(n);if(t){a=t.getItems()}else{s.error("CalendarLegend with id '"+n+"' does not exist!",e)}}return a};d.getAriaTextForType=function(e,a){var n,r,i,s;if(a&&a.length){for(var s=0;s<a.length;s++){i=a[s];if(i.getType()===e){n=i.getText();break}}}if(!n){r=t.getTypeAriaText(e);if(r){n=r.getText()}}return n};return d},true);