/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./library","sap/ui/core/Core","sap/ui/Device","./NotificationListBase","sap/ui/core/InvisibleText","sap/ui/core/IconPool","sap/ui/core/Icon","sap/ui/core/ResizeHandler","sap/m/Link","sap/m/Avatar","sap/ui/events/KeyCodes","./NotificationListItemRenderer"],function(t,e,i,o,s,r,n,a,u,p,h,g){"use strict";var l=e.getLibraryResourceBundle("sap.m"),f=l.getText("NOTIFICATION_LIST_ITEM_SHOW_MORE"),I=l.getText("NOTIFICATION_LIST_ITEM_SHOW_LESS"),c=l.getText("NOTIFICATION_LIST_ITEM_READ"),T=l.getText("NOTIFICATION_LIST_ITEM_UNREAD");var _=44;var d=t.AvatarSize;var y=t.AvatarColor;var v=o.extend("sap.m.NotificationListItem",{metadata:{library:"sap.m",properties:{description:{type:"string",group:"Appearance",defaultValue:""},authorInitials:{type:"string",group:"Data",defaultValue:null},truncate:{type:"boolean",group:"Appearance",defaultValue:true},hideShowMoreButton:{type:"boolean",group:"Appearance",defaultValue:false}},aggregations:{processingMessage:{type:"sap.m.MessageStrip",multiple:false},_showMoreButton:{type:"sap.m.Link",multiple:false,visibility:"hidden"}}}});v.prototype.init=function(){this.setType("Active");this._footerIvisibleText=new s({id:this.getId()+"-invisibleFooterText"})};v.prototype._getAuthorAvatar=function(){var t=new p({initials:this.getAuthorInitials(),src:this.getAuthorPicture(),backgroundColor:y.Random,displaySize:d.XS});return t};v.prototype.onBeforeRendering=function(){o.prototype.onBeforeRendering.call(this);if(this._resizeListenerId){a.deregister(this._resizeListenerId);this._resizeListenerId=null}};v.prototype.onAfterRendering=function(){if(this.getHideShowMoreButton()){return}this._updateShowMoreButtonVisibility();if(this.getDomRef()){this._resizeListenerId=a.register(this.getDomRef(),this._onResize.bind(this))}};v.prototype.onfocusin=function(t){o.prototype.onfocusin.apply(this,arguments);if(!i.browser.msie){return}var e=t.target;if(e!==this.getDomRef()&&!e.classList.contains("sapMBtn")&&!e.classList.contains("sapMLnk")){t.preventDefault();t.stopImmediatePropagation();this.focus()}};v.prototype.onkeydown=function(t){if(t.target!==this.getDomRef()){return}var e=this.getParent(),i,o;if(!e||!e.isA("sap.m.NotificationListGroup")){return}i=e.getVisibleItems();o=i.indexOf(this);switch(t.which){case h.ARROW_UP:if(o===0){return}var s=o-1;i[s].focus();break;case h.ARROW_DOWN:var r=o+1;if(r===i.length){return}i[r].focus();break}};v.prototype.exit=function(){if(this._resizeListenerId){a.deregister(this._resizeListenerId);this._resizeListenerId=null}if(this._footerIvisibleText){this._footerIvisibleText.destroy();this._footerIvisibleText=null}};v.prototype._onResize=function(){this._updateShowMoreButtonVisibility()};v.prototype._updateShowMoreButtonVisibility=function(){var t=this.$(),e=t.find(".sapMNLITitleText")[0],i=t.find(".sapMNLIDescription")[0],o;if(t.length>0){o=e.scrollHeight>_||i.scrollHeight>_}this._getShowMoreButton().setVisible(o)};v.prototype._getShowMoreButton=function(){var t=this.getAggregation("_showMoreButton");if(!t){t=new u(this.getId()+"-showMoreButton",{text:this.getTruncate()?f:I,press:function(){var t=!this.getTruncate();this._getShowMoreButton().setText(t?f:I);this.setTruncate(t)}.bind(this)});this.setAggregation("_showMoreButton",t,true)}return t};v.prototype._getFooterInvisibleText=function(){var t=this.getUnread()?T:c,e=l.getText("NOTIFICATION_LIST_ITEM_DATETIME_PRIORITY",[this.getDatetime(),this.getPriority()]),i=this.getAuthorName(),o=[t];if(i){i=l.getText("NOTIFICATION_LIST_ITEM_CREATED_BY");o.push(i);o.push(this.getAuthorName())}o.push(e);return this._footerIvisibleText.setText(o.join(" "))};return v});