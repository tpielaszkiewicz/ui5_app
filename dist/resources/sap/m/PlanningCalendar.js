/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/m/delegate/DateNavigation","sap/ui/core/Control","sap/ui/base/ManagedObject","sap/ui/base/ManagedObjectObserver","sap/ui/unified/library","sap/ui/unified/calendar/CalendarUtils","sap/ui/unified/calendar/CalendarDate","sap/ui/unified/calendar/DatesRow","sap/ui/unified/calendar/OneMonthDatesRow","sap/ui/unified/calendar/MonthsRow","sap/ui/unified/calendar/TimesRow","sap/ui/unified/DateRange","sap/ui/unified/CalendarAppointment","sap/ui/unified/CalendarRow","sap/ui/unified/CalendarRowRenderer","sap/ui/Device","sap/ui/core/Core","sap/ui/core/Element","sap/ui/core/Renderer","sap/ui/core/ResizeHandler","sap/ui/core/InvisibleText","sap/ui/core/Item","sap/ui/core/dnd/DragInfo","sap/ui/core/dnd/DropInfo","sap/ui/core/dnd/DragDropInfo","sap/ui/core/format/DateFormat","sap/m/Select","sap/m/Button","sap/m/OverflowToolbar","sap/m/Toolbar","sap/m/Table","sap/m/Column","sap/m/ColumnListItem","sap/m/ColumnListItemRenderer","sap/m/SegmentedButtonItem","sap/m/StandardListItem","sap/m/StandardListItemRenderer","sap/m/PlanningCalendarHeader","sap/m/PlanningCalendarRow","sap/m/PlanningCalendarRenderer","sap/m/PlanningCalendarView","sap/m/CheckBox","sap/m/library","sap/base/util/deepEqual","sap/base/Log","sap/ui/thirdparty/jquery","sap/ui/dom/jquery/control"],function(e,t,a,i,n,s,r,o,l,h,g,p,d,u,c,f,m,_,D,w,v,y,S,C,T,R,A,b,M,I,k,P,H,N,V,O,E,x,L,B,z,U,W,K,F,Y){"use strict";var G=W.Sticky;var j=n.CalendarDayType;var $=W.ListMode;var J=W.ToolbarDesign;var q=W.PlanningCalendarBuiltInView;var X=W.ScreenSize;var Q=n.CalendarAppointmentVisualization;var Z=n.GroupAppointmentsMode;var ee=n.CalendarIntervalType;var te="DragDropConfig";var ae="ResizeConfig";var ie="CreateConfig";var ne="-CLI";var se=t.extend("sap.m.PlanningCalendar",{metadata:{library:"sap.m",properties:{startDate:{type:"object",group:"Data"},viewKey:{type:"string",group:"Appearance",defaultValue:ee.Hour},singleSelection:{type:"boolean",group:"Misc",defaultValue:true},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},showIntervalHeaders:{type:"boolean",group:"Appearance",defaultValue:true},showEmptyIntervalHeaders:{type:"boolean",group:"Appearance",defaultValue:true},showRowHeaders:{type:"boolean",group:"Appearance",defaultValue:true},noDataText:{type:"string",group:"Misc",defaultValue:null},groupAppointmentsMode:{type:"sap.ui.unified.GroupAppointmentsMode",group:"Appearance",defaultValue:Z.Collapsed},appointmentsReducedHeight:{type:"boolean",group:"Appearance",defaultValue:false},appointmentsVisualization:{type:"sap.ui.unified.CalendarAppointmentVisualization",group:"Appearance",defaultValue:Q.Standard},minDate:{type:"object",group:"Misc",defaultValue:null},maxDate:{type:"object",group:"Misc",defaultValue:null},showDayNamesLine:{type:"boolean",group:"Appearance",defaultValue:false},showWeekNumbers:{type:"boolean",group:"Appearance",defaultValue:false},builtInViews:{type:"string[]",group:"Appearance",defaultValue:[]},stickyHeader:{type:"boolean",group:"Appearance",defaultValue:false}},aggregations:{rows:{type:"sap.m.PlanningCalendarRow",multiple:true,singularName:"row"},views:{type:"sap.m.PlanningCalendarView",multiple:true,singularName:"view"},specialDates:{type:"sap.ui.unified.DateTypeRange",multiple:true,singularName:"specialDate"},toolbarContent:{type:"sap.ui.core.Control",multiple:true,singularName:"toolbarContent",forwarding:{getter:"_getHeader",aggregation:"actions"},forwardBinding:true},table:{type:"sap.m.Table",multiple:false,visibility:"hidden"},header:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"},legend:{type:"sap.ui.unified.CalendarLegend",multiple:false}},events:{appointmentSelect:{parameters:{appointment:{type:"sap.ui.unified.CalendarAppointment"},appointments:{type:"sap.ui.unified.CalendarAppointment[]"},multiSelect:{type:"boolean"},domRefId:{type:"string"}}},intervalSelect:{parameters:{startDate:{type:"object"},endDate:{type:"object"},subInterval:{type:"boolean"},row:{type:"sap.m.PlanningCalendarRow"}}},rowSelectionChange:{parameters:{rows:{type:"sap.m.PlanningCalendarRow[]"}}},startDateChange:{},viewChange:{},rowHeaderClick:{parameters:{headerId:{type:"string"},row:{type:"sap.m.PlanningCalendarRow"}}}},designtime:"sap/m/designtime/PlanningCalendar.designtime"},constructor:function(e,a){t.prototype.constructor.apply(this,arguments);if(typeof e!=="string"){a=e}if(a&&typeof a.customAppointmentsSorterCallback==="function"){this._fnCustomSortedAppointments=a.customAppointmentsSorterCallback}}});var re=["_oTimesRow","_oDatesRow","_oMonthsRow","_oWeeksRow","_oOneMonthsRow"],oe={};oe[ee.Day]={sInstanceName:"_oDatesRow",sIdSuffix:"-DatesRow",oClass:o};oe[ee.Week]={sInstanceName:"_oWeeksRow",sIdSuffix:"-WeeksRow",oClass:o};oe[ee.OneMonth]={sInstanceName:"_oOneMonthsRow",sIdSuffix:"-OneMonthsRow",oClass:l};var le=X.Desktop;var he=[q.Hour,q.Day,q.Month,q.Week,q.OneMonth];var ge={PHONE:"600",TABLET:"1024"};var pe=["sap.ui.unified.calendar.TimesRow","sap.ui.unified.calendar.DatesRow","sap.ui.unified.calendar.MonthsRow","sap.ui.unified.calendar.OneMonthDatesRow"];var de=t.extend("CalendarHeader",{metadata:{aggregations:{toolbar:{type:"sap.m.Toolbar",multiple:false},allCheckBox:{type:"sap.m.CheckBox",multiple:false}}},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t);e.class("sapMPlanCalHead");e.openEnd();var a=t.getToolbar();if(a){e.renderControl(a)}var i=t.getAllCheckBox();if(i){e.renderControl(i)}e.close("div")}}});se.prototype.init=function(){this._dateNav=new e;this._iBreakPointTablet=f.media._predefinedRangeSets[f.media.RANGESETS.SAP_STANDARD_EXTENDED].points[0];this._iBreakPointDesktop=f.media._predefinedRangeSets[f.media.RANGESETS.SAP_STANDARD_EXTENDED].points[1];this._iBreakPointLargeDesktop=f.media._predefinedRangeSets[f.media.RANGESETS.SAP_STANDARD_EXTENDED].points[2];if(f.system.phone||Y("html").hasClass("sapUiMedia-Std-Phone")){this._iSize=0;this._iSizeScreen=0}else if(f.system.tablet||Y("html").hasClass("sapUiMedia-Std-Tablet")){this._iSize=1;this._iSizeScreen=1}else{this._iSize=2;this._iSizeScreen=2}this.setAggregation("header",this._createHeader());this._attachHeaderEvents();this._oRB=m.getLibraryResourceBundle("sap.m");var t=this.getId();this._oIntervalTypeSelect=this._getHeader()._getOrCreateViewSwitch();this._oIntervalTypeSelect.attachEvent("selectionChange",ue,this);this._oTodayButton=this._getHeader()._getTodayButton();this._oCalendarHeader=new de(t+"-CalHead",{});this._oInfoToolbar=new I(t+"-InfoToolbar",{height:"auto",design:J.Transparent,content:[this._oCalendarHeader,this._oTimesRow]});var a=new k(t+"-Table",{sticky:[],infoToolbar:this._oInfoToolbar,mode:$.SingleSelectMaster,columns:[new P({styleClass:"sapMPlanCalRowHead"}),new P({width:"80%",styleClass:"sapMPlanCalAppRow",minScreenWidth:le,demandPopin:true})],ariaLabelledBy:t+"-Descr"});a.attachEvent("selectionChange",Ie,this);a.addDelegate({onBeforeRendering:function(){if(this._rowHeaderClickEvent){this._rowHeaderClickEvent.off()}},onAfterRendering:function(){this._rowHeaderClickEvent=a.$().find(".sapMPlanCalRowHead > div.sapMLIB").click(function(e){var t=Y(e.currentTarget).control(0),a=Re(t.getParent()),i=t.getId();this.fireRowHeaderClick({headerId:i,row:a})}.bind(this));this._adjustColumnHeadersTopOffset()}},false,this);this.setAggregation("table",a,true);this.setStartDate(new Date);this._resizeProxy=Y.proxy(_e,this);this._fnCustomSortedAppointments=undefined;this.iWidth=0};se.prototype.exit=function(){if(this._sResizeListener){w.deregister(this._sResizeListener);this._sResizeListener=undefined}f.orientation.detachHandler(this._updateStickyHeader,this);if(this._sUpdateCurrentTime){clearTimeout(this._sUpdateCurrentTime);this._sUpdateCurrentTime=undefined}var e=this.getAggregation("table");e.removeAllItems();re.forEach(function(e){if(this[e]){this[e]._oPlanningCalendar=undefined;this[e].destroy();this[e]=undefined}},this);if(this._oViews){for(var t in this._oViews){this._oViews[t].destroy()}}if(this._oSelectAllCheckBox){this._oSelectAllCheckBox.destroy()}if(this._rowHeaderClickEvent){this._rowHeaderClickEvent.off();this._rowHeaderClickEvent=null}};se.prototype.onBeforeRendering=function(){this._bBeforeRendering=true;if(!this._oTimesRow&&!this._oDatesRow&&!this._oMonthsRow&&!this._oWeeksRow&&!this._oOneMonthsRow||this._bCheckView){this.setViewKey(this.getViewKey());this._bCheckView=undefined}He.call(this);if(this._sUpdateCurrentTime){clearTimeout(this._sUpdateCurrentTime);this._sUpdateCurrentTime=undefined}this._updatePickerSelection();f.orientation.detachHandler(this._updateStickyHeader,this);this._bBeforeRendering=undefined;this._toggleStickyClasses()};se.prototype.attachEvent=function(e,a,i,n){t.prototype.attachEvent.call(this,e,a,i,n);if(this.hasListeners("intervalSelect")){re.forEach(function(e){if(this[e]){this[e]._setAriaRole("button")}},this)}return this};se.prototype.detachEvent=function(e,a,i){t.prototype.detachEvent.call(this,e,a,i);if(!this.hasListeners("intervalSelect")){re.forEach(function(e){if(this[e]){this[e]._setAriaRole("gridcell")}},this)}return this};se.prototype._createHeader=function(){var e=new x(this.getId()+"-Header");e.getAggregation("_actionsToolbar").addAriaLabelledBy(v.getStaticId("sap.m","PC_FUNCTIONS_TOOLBAR"));e.getAggregation("_navigationToolbar").addAriaLabelledBy(v.getStaticId("sap.m","PC_INTERVAL_SELECTION_TOOLBAR"));return e};se.prototype._attachHeaderEvents=function(){var e=this._getHeader();e.attachEvent("pressPrevious",this._handlePressArrow,this);e.attachEvent("pressToday",this._handleTodayPress,this);e.attachEvent("pressNext",this._handlePressArrow,this);e.attachEvent("dateSelect",this._handleDateSelect,this);return this};se.prototype._handlePressArrow=function(e){this._applyArrowsLogic(e.getId()==="pressPrevious")};se.prototype._applyArrowsLogic=function(e){if(e){this._dateNav.previous()}else{this._dateNav.next()}if(this.getMinDate()){if(this._dateNav.getStart().getTime()<=this.getMinDate().getTime()){this._getHeader()._oPrevBtn.setEnabled(false);this._dateNav.setStart(this.getMinDate());this._dateNav.setCurrent(this.getMinDate())}else{this._getHeader()._oPrevBtn.setEnabled(true)}}if(this.getMaxDate()){if(this._dateNav.getEnd().getTime()>=this.getMaxDate().getTime()){this._getHeader()._oNextBtn.setEnabled(false);this._dateNav.setStart(this.getMaxDate());this._dateNav.setCurrent(this.getMaxDate())}else{this._getHeader()._oNextBtn.setEnabled(true)}}var t=this._getRowInstanceByViewKey(this.getViewKey());this.setStartDate(this._dateNav.getStart());t.setDate(this._dateNav.getCurrent());this._updatePickerSelection();this.fireStartDateChange()};se.prototype._formatPickerText=function(){var e=this._getFirstAndLastRangeDate(),t=s._createLocalDate(e.oStartDate,true),a=s._createLocalDate(e.oEndDate,true),i=this.getViewKey(),n=ee[i]?ee[i]:this._getView(i).getIntervalType(),r=m.getConfiguration().getRTL(),o,l,h,g;switch(n){case ee.Hour:o=R.getDateInstance({format:"yMMMMd"});h=o.format(t);if(t.getDate()!==a.getDate()){g=o.format(a)}break;case ee.Day:case ee.Week:o=R.getDateInstance({format:"yMMMMd"});h=o.format(t);g=o.format(a);break;case ee.OneMonth:o=R.getDateInstance({format:"yMMMM"});h=o.format(t);break;case ee.Month:o=R.getDateInstance({format:"y"});h=o.format(t);if(t.getFullYear()!==a.getFullYear()){g=o.format(a)}break;default:throw new Error("Unknown IntervalType: "+i+"; "+this)}if(!r){l=h;if(g){l+=" - "+g}}else{if(g){l=g+" - "+h}else{l=h}}return l};se.prototype._getFirstAndLastRangeDate=function(){var e=s._createUniversalUTCDate(this.getStartDate(),"Gregorian",true),t=s._createUniversalUTCDate(this._dateNav.getEnd(),"Gregorian",true);return{oStartDate:e,oEndDate:t}};se.prototype._getHeader=function(){return this.getAggregation("header")};se.prototype._toggleStickyClasses=function(){this.toggleStyleClass("sapMPCSticky",this.getStickyHeader());return this};se.prototype._adjustColumnHeadersTopOffset=function(){var e=this.getStickyHeader(),t=this.getDomRef().querySelector(".sapMListInfoTBarContainer"),a;switch(e){case true:a=this._getHeader().$().outerHeight()+"px";break;default:a="auto";break}t.style.top=a;return this};se.prototype._setAriaRole=function(e){if(this.hasListeners("intervalSelect")){e._setAriaRole("button")}else{e._setAriaRole("gridcell")}};se.prototype._updateTodayButtonState=function(){if(this._oTodayButton){this._oTodayButton.setEnabled(!this._dateMatchesVisibleRange(new Date,this.getViewKey()))}};se.prototype._dateMatchesVisibleRange=function(e,t){var a=this._getView(t,!this._bBeforeRendering);if(!a){return false}var i=a.getIntervalType(),n=oe[i],o=n?this[n.sInstanceName]:null,l=false;if(o&&t==="One Month"){return s._isSameMonthAndYear(r.fromLocalJSDate(this.getStartDate()),r.fromLocalJSDate(e))}else if(o&&t==="Week"){var h=o.getDays(),g=r.fromLocalJSDate(e),p=r.fromLocalJSDate(this.getStartDate()),d=r.fromLocalJSDate(this.getStartDate());d.setDate(d.getDate()+h);return g.isSameOrAfter(p)&&g.isBefore(d)}return l};se.prototype.onAfterRendering=function(e){e.size={width:this.getDomRef().offsetWidth};_e.call(this,e,true);if(!this._sResizeListener){this._sResizeListener=w.register(this,this._resizeProxy)}if(f.system.phone&&this.getStickyHeader()){f.orientation.attachHandler(this._updateStickyHeader,this)}this._updateCurrentTimeVisualization(false);if(this.getHeight()){var t=this.getDomRef().querySelector("table");if(this.getHeight().indexOf("%")>-1){t.style.height=this.getHeight();return}var a=this.$().height()-this._oInfoToolbar.$().height()+"px";t.style.height=a}this._adjustColumnHeadersTopOffset()};se.prototype.onThemeChanged=function(){if(this.getDomRef()){this._adjustColumnHeadersTopOffset()}};se.prototype.addToolbarContent=function(e){if(e&&e.isA("sap.m.Title")){this._observeHeaderTitleText(e);this._getHeader().setTitle(e.getText());e.setVisible(false)}this.addAggregation("toolbarContent",e);return this};se.prototype.insertToolbarContent=function(e,t){if(e&&e.isA("sap.m.Title")){this._observeHeaderTitleText(e);this._getHeader().setTitle(e.getText());e.setVisible(false)}this.insertAggregation("toolbarContent",e,t);return this};se.prototype.removeToolbarContent=function(e){var t;if(e&&e.isA("sap.m.Title")){this._getHeader().setTitle("");this._disconnectAndDestroyHeaderObserver()}else{t=this.removeAggregation("toolbarContent",e)}return t};se.prototype.removeAllToolbarContent=function(){var e=this.removeAllAggregation("toolbarContent");this._getHeader().setTitle("");this._disconnectAndDestroyHeaderObserver();return e};se.prototype.destroyToolbarContent=function(){var e=this.destroyAggregation("toolbarContent");this._getHeader().setTitle("");this._disconnectAndDestroyHeaderObserver();return e};se.prototype._getHeaderObserver=function(){if(!this._oHeaderObserver){this._oHeaderObserver=new i(this._handleTitleTextChange.bind(this))}return this._oHeaderObserver};se.prototype._observeHeaderTitleText=function(e){this._getHeaderObserver().observe(e,{properties:["text"]})};se.prototype._handleTitleTextChange=function(e){this._getHeader().setTitle(e.current)};se.prototype._disconnectAndDestroyHeaderObserver=function(){if(this._oHeaderObserver){this._oHeaderObserver.disconnect();this._oHeaderObserver.destroy();this._oHeaderObserver=null}};se.prototype.setStartDate=function(e){var t,a,i;if(!e){i=new Date}else{s._checkJSDateObject(e);i=new Date(e.getTime())}if(this.getViewKey()===q.Week){t=s.getFirstDateOfWeek(s._createUniversalUTCDate(i,undefined,true));i.setTime(s._createLocalDate(t,true).getTime())}if(this.getViewKey()===q.OneMonth||this.getViewKey()===q.Month){a=s.getFirstDateOfMonth(s._createUniversalUTCDate(i,undefined,true));i.setTime(s._createLocalDate(a,true).getTime())}if(K(i,this.getStartDate())){this._updateTodayButtonState();return this}var n=i.getFullYear();s._checkYearInValidRange(n);var r=this.getMinDate();if(r&&r.getTime()>i.getTime()){F.warning("StartDate < minDate -> StartDate set to minDate",this);i=new Date(r.getTime())}else{var o=this.getMaxDate();if(o&&o.getTime()<i.getTime()){F.warning("StartDate > maxDate -> StartDate set to minDate",this);if(r){i=new Date(r.getTime())}else{i=new Date(1,0,1);i.setFullYear(1)}}}this.setProperty("startDate",i,true);this._dateNav.setStart(i);this._getHeader().setStartDate(i);re.forEach(function(e){if(this[e]){this[e].setStartDate(new Date(i.getTime()))}},this);if(this.getViewKey()===q.OneMonth&&this._oOneMonthsRow.getMode()<2&&this._oOneMonthsRow.getSelectedDates().length){this._setRowsStartDate(this._oOneMonthsRow.getSelectedDates()[0].getStartDate())}else{this._setRowsStartDate(new Date(i.getTime()))}if(this.getViewKey()===q.Week||this.getViewKey()===q.OneMonth){this._updateTodayButtonState()}if(this.getDomRef()){this._updateCurrentTimeVisualization(false);this._updatePickerSelection()}return this};se.prototype.setMinDate=function(e){if(K(e,this.getMinDate())){return this}var t=this.getMaxDate(),a=this._getHeader();if(e){s._checkJSDateObject(e);var i=e.getFullYear();s._checkYearInValidRange(i);this.setProperty("minDate",e,true);this._bNoStartDateChange=true;a.getAggregation("_calendarPicker").setMinDate(new Date(e.getTime()));if(t&&t.getTime()<e.getTime()){F.warning("minDate > maxDate -> maxDate set to end of the month",this);t=new Date(e.getTime());t.setMonth(t.getMonth()+1,0);t.setHours(23);t.setMinutes(59);t.setSeconds(59);t.setMilliseconds(0);this.setMaxDate(t)}this._bNoStartDateChange=undefined;var n=this.getStartDate();if(n&&n.getTime()<e.getTime()){F.warning("StartDate < minDate -> StartDate set to minDate",this);n=new Date(e.getTime());this.setStartDate(n);a.setPickerText(this._formatPickerText())}}else{this.setProperty("minDate",undefined,true);a.getAggregation("_calendarPicker").setMinDate()}var r=new Date;if(e&&r.getTime()<e.getTime()){this._oTodayButton.setVisible(false)}else if(!t||r.getTime()<t.getTime()){this._oTodayButton.setVisible(true)}return this};se.prototype.setMaxDate=function(e){if(K(e,this.getMaxDate())){return this}var t=this.getMinDate(),a=this._getHeader();if(e){s._checkJSDateObject(e);var i=e.getFullYear();s._checkYearInValidRange(i);this.setProperty("maxDate",e,true);this._bNoStartDateChange=true;a.getAggregation("_calendarPicker").setMaxDate(new Date(e.getTime()));if(t&&t.getTime()>e.getTime()){F.warning("maxDate < minDate -> maxDate set to begin of the month",this);t=new Date(e.getTime());t.setDate(1);t.setHours(0);t.setMinutes(0);t.setSeconds(0);t.setMilliseconds(0);this.setMinDate(t)}this._bNoStartDateChange=undefined;var n=this.getStartDate();if(n&&n.getTime()>e.getTime()){F.warning("StartDate > maxDate -> StartDate set to minDate",this);if(t){n=new Date(t.getTime())}else{n=new Date(1,0,1);n.setFullYear(1)}this.setStartDate(n);a.setPickerText(this._formatPickerText())}}else{this.setProperty("maxDate",undefined,true);a.getAggregation("_calendarPicker").setMaxDate()}var r=new Date;if(e&&r.getTime()>e.getTime()){this._oTodayButton.setVisible(false)}else if(!t||r.getTime()>t.getTime()){this._oTodayButton.setVisible(true)}return this};se.prototype.removeIntervalInstanceFromInfoToolbar=function(){var e=this._oInfoToolbar.getContent();e.forEach(function(e){if(e.isA(pe)){this._oInfoToolbar.removeContent(e)}}.bind(this))};se.prototype.setViewKey=function(e){var t,a,i,n=this.getViewKey(),s=this._getHeader(),o;this.setProperty("viewKey",e,true);this._oIntervalTypeSelect.setSelectedKey(e);this.removeIntervalInstanceFromInfoToolbar();var l=this.getStartDate();var p=this.getMinDate();var d=this.getMaxDate();var u=this._getView(e,!this._bBeforeRendering);if(!u){this._bCheckView=true;this.invalidate()}else{var c=u.getIntervalType();var f=this._getIntervals(u);this._bCheckView=false;this._dateNav.setUnit(c);this._dateNav.setStep(f);this._dateNav.setCurrent(undefined);switch(c){case ee.Hour:if(!this._oTimesRow){this._oTimesRow=new g(this.getId()+"-TimesRow",{startDate:new Date(l.getTime()),items:f,legend:this.getLegend()});this._setAriaRole(this._oTimesRow);this._oTimesRow._setLegendControlOrigin(this);this._oTimesRow.attachEvent("focus",this._handleFocus,this);this._oTimesRow.attachEvent("select",this._handleCalendarSelect,this);this._oTimesRow._oPlanningCalendar=this;this._oTimesRow.getSpecialDates=function(){return this._oPlanningCalendar.getSpecialDates()}}else if(this._oTimesRow.getItems()!==f){this._oTimesRow.setItems(f);this._dateNav.setStep(f)}this._oTimesRow.addAriaLabelledBy(v.getStaticId("sap.m","PC_INTERVAL_TOOLBAR"));this._insertInterval(this._oTimesRow);s.setAssociation("currentPicker",s.getAggregation("_calendarPicker"));break;case ee.Day:case ee.Week:case ee.OneMonth:i=oe[c];t=this[i.sInstanceName];if(!t){t=new i.oClass(this.getId()+i.sIdSuffix,{startDate:new Date(l.getTime()),days:f,showDayNamesLine:this.getShowDayNamesLine(),legend:this.getLegend(),showWeekNumbers:this.getShowWeekNumbers()});this._setAriaRole(t);t.attachEvent("select",this._handleCalendarSelect,this);t.attachEvent("focus",this._handleFocus,this);if(e===q.OneMonth){t._setRowsStartDate=this._setRowsStartDate.bind(this)}t._oPlanningCalendar=this;t.getSpecialDates=function(){return this._oPlanningCalendar.getSpecialDates()}}else if(t.getDays()!==f){t.setDays(f);this._dateNav.setStep(f)}t.addAriaLabelledBy(v.getStaticId("sap.m","PC_INTERVAL_TOOLBAR"));this._insertInterval(t);this[i.sInstanceName]=t;if(c===ee.OneMonth){s.setAssociation("currentPicker",s.getAggregation("_monthPicker"))}else{s.setAssociation("currentPicker",s.getAggregation("_calendarPicker"))}break;case ee.Month:if(!this._oMonthsRow){this._oMonthsRow=new h(this.getId()+"-MonthsRow",{startDate:new Date(l.getTime()),months:f,legend:this.getLegend()});this._setAriaRole(this._oMonthsRow);this._oMonthsRow._setLegendControlOrigin(this);this._oMonthsRow.attachEvent("focus",this._handleFocus,this);this._oMonthsRow.attachEvent("select",this._handleCalendarSelect,this);this._oMonthsRow._oPlanningCalendar=this;this._oMonthsRow.getSpecialDates=function(){return this._oPlanningCalendar.getSpecialDates()}}else if(this._oMonthsRow.setMonths()!==f){this._oMonthsRow.setMonths(f);this._dateNav.setStep(f)}this._oMonthsRow.addAriaLabelledBy(v.getStaticId("sap.m","PC_INTERVAL_TOOLBAR"));this._insertInterval(this._oMonthsRow);s.setAssociation("currentPicker",s.getAggregation("_yearPicker"));break;default:throw new Error("Unknown IntervalType: "+c+"; "+this)}var m=this.getRows();for(var _=0;_<m.length;_++){var D=m[_];var w=Me(D);w.setIntervalType(c);w.setIntervals(f);w.setShowSubIntervals(u.getShowSubIntervals())}if(this.getDomRef()){this._updateCurrentTimeVisualization(false);fe.call(this,this.getShowWeekNumbers(),this._viewAllowsWeekNumbers(e));me.call(this,this.getShowDayNamesLine(),!!t)}this._updatePickerSelection()}if(e===q.Week||e===q.OneMonth||e===q.Month){a=this.getStartDate();this.setStartDate(new Date(a.getTime()));if(a.getTime()!==this.getStartDate().getTime()){this.fireStartDateChange()}}if(this._oOneMonthsRow&&e===q.OneMonth){this._oOneMonthsRow.setMode(this._iSize);this._adjustSelectedDate(r.fromLocalJSDate(a));if(this._iSize<2){this._setRowsStartDate(a)}}else if(this._oOneMonthsRow&&n===q.OneMonth&&this._oOneMonthsRow.getSelectedDates().length){o=this._oOneMonthsRow.getSelectedDates()[0].getStartDate();if(o){this.setStartDate(o)}}if(p){s.getAggregation("_calendarPicker").setMinDate(new Date(p.getTime()));s.getAggregation("_yearPicker").setMinDate(new Date(p.getTime()))}if(d){s.getAggregation("_calendarPicker").setMaxDate(new Date(d.getTime()));s.getAggregation("_yearPicker").setMaxDate(new Date(d.getTime()))}this._updateTodayButtonState();return this};se.prototype._handleFocus=function(e){var t=e.getParameter("date");var a=e.getParameter("restoreOldDate");if(a){return}this.shiftToDate(t,e.getParameter("otherMonth"))};se.prototype.shiftToDate=function(e,t){var a=this._getRowInstanceByViewKey(this.getViewKey()),i,n;this._dateNav.toDate(e);i=this._dateNav.getStart();n=this._dateNav.getCurrent();if(a&&!(a.getMode&&a.getMode()<2&&!t)){this.setStartDate(i);a.setStartDate(i);a.setDate(n)}};se.prototype._updatePickerSelection=function(){var e=this._getFirstAndLastRangeDate(),t=this._getHeader().getAssociation("currentPicker"),a=m.byId(t),i;i=new p({startDate:new Date(e.oStartDate),endDate:new Date(e.oEndDate)});a.destroySelectedDates();a.addSelectedDate(i);this._getHeader().setPickerText(this._formatPickerText());this._updateTodayButtonState()};se.prototype._adjustSelectedDate=function(e,t){var a=t?s._getFirstDateOfMonth(e):e,i=a.toLocalJSDate();if(this._oOneMonthsRow.getMode&&this._oOneMonthsRow.getMode()<2){this._oOneMonthsRow.removeAllSelectedDates();this._oOneMonthsRow.addSelectedDate(new p({startDate:i}));this._oOneMonthsRow.selectDate(i)}};se.prototype._insertInterval=function(e){if(this._iSizeScreen>1){this._oInfoToolbar.addContent(e)}else{this._oInfoToolbar.insertContent(e,1)}};se.prototype._viewAllowsWeekNumbers=function(e){var t=this._getView(e).getIntervalType(),a=oe[t];return!!a&&!!a.oClass.prototype.setShowWeekNumbers};se.prototype._viewAllowsDayNamesLine=function(e){var t=this._getView(e).getIntervalType(),a=oe[t];return!!a&&!!a.oClass.prototype.setShowDayNamesLine};se.prototype._getRowInstanceByViewKey=function(e){var t=this._getView(e).getIntervalType(),a=oe[t],i;if(a){i=this[a.sInstanceName]}if(t===ee.Month){i=this._oMonthsRow}if(t===ee.Hour){i=this._oTimesRow}return i};se.prototype.setShowWeekNumbers=function(e){this.setProperty("showWeekNumbers",e,true);this._getViews().forEach(function(t){var a=t.getKey(),i=this._viewAllowsWeekNumbers(a),n=this._getRowInstanceByViewKey(a);if(n&&i){n.setShowWeekNumbers(e)}if(this.getDomRef()&&this.getViewKey()===a){fe.call(this,e,i)}},this);return this};se.prototype.setShowIntervalHeaders=function(e){this.setProperty("showIntervalHeaders",e,true);var t=this.getRows();for(var a=0;a<t.length;a++){var i=t[a];Me(i).setShowIntervalHeaders(e)}return this};se.prototype.setShowEmptyIntervalHeaders=function(e){this.setProperty("showEmptyIntervalHeaders",e,true);var t=this.getRows();for(var a=0;a<t.length;a++){var i=t[a];Me(i).setShowEmptyIntervalHeaders(e)}return this};se.prototype.setGroupAppointmentsMode=function(e){this.setProperty("groupAppointmentsMode",e,true);var t=this.getRows();for(var a=0;a<t.length;a++){var i=t[a];Me(i).setGroupAppointmentsMode(e)}return this};se.prototype.setAppointmentsReducedHeight=function(e){this.setProperty("appointmentsReducedHeight",e,true);var t=this.getRows();for(var a=0;a<t.length;a++){var i=t[a];Me(i).setAppointmentsReducedHeight(e)}return this};se.prototype.setAppointmentsVisualization=function(e){this.setProperty("appointmentsVisualization",e,true);var t=this.getRows();for(var a=0;a<t.length;a++){var i=t[a];Me(i).setAppointmentsVisualization(e)}return this};se.prototype.setShowRowHeaders=function(e){this.setProperty("showRowHeaders",e,true);var t=this.getAggregation("table");t.getColumns()[0].setVisible(e);this._toggleAppointmentsColumnPopinState(e);this.$().toggleClass("sapMPlanCalNoHead",!e);Ee.call(this);xe.call(this);return this};se.prototype.setShowDayNamesLine=function(e){var t,a,i,n=!!this.getDomRef(),s=this.getViewKey();for(t in oe){a=oe[t].sInstanceName;if(this[a]){i=this[a];i.setShowDayNamesLine(e);if(n&&t===s){me.call(this,e,true)}}}return this.setProperty("showDayNamesLine",e,false)};se.prototype.setStickyHeader=function(e){if(this.getStickyHeader()===e){return this}this.setProperty("stickyHeader",e,true);if(f.system.phone){if(e){f.orientation.attachHandler(this._updateStickyHeader,this)}else{f.orientation.detachHandler(this._updateStickyHeader,this)}}this._updateStickyHeader();return this};se.prototype._updateStickyHeader=function(){var e=[],t=this.getStickyHeader(),a=this.getViewKey()===q.OneMonth&&this._iSize<2,i=t&&!f.system.phone&&!a,n=t&&!(f.system.phone&&f.orientation.landscape)&&!a;if(i){e.push(G.HeaderToolbar)}if(this._oInfoToolbar&&n){e.push(G.InfoToolbar)}this.getAggregation("table").setSticky(e)};se.prototype.addRow=function(e){this.addAggregation("rows",e,true);this.getAggregation("table").addItem(this._createPlanningCalendarListItem(e));return this};se.prototype.insertRow=function(e,t){this.insertAggregation("rows",e,t);this.getAggregation("table").insertItem(this._createPlanningCalendarListItem(e),t,true);return this};se.prototype.removeRow=function(e){var t=this.removeAggregation("rows",e,true),a=this.getAggregation("table");a.removeItem(Ae(t),true);this._handleRowRemoval(t);Oe.call(this);xe.call(this);return t};se.prototype.removeAllRows=function(){var e=this.removeAllAggregation("rows",true),t=this.getAggregation("table");t.removeAllItems(true);e.forEach(this._handleRowRemoval,this);Oe.call(this);xe.call(this);return e};se.prototype.destroyRows=function(){var e;var t=this.getAggregation("table");t.destroyItems(true);e=this.destroyAggregation("rows");Oe.call(this);xe.call(this);return e};se.prototype.setSingleSelection=function(e){this.setProperty("singleSelection",e,true);Ee.call(this);xe.call(this);if(e){this.selectAllRows(false)}else{Oe.call(this)}this.$().toggleClass("sapMPlanCalMultiSel",!e);return this};se.prototype.setNoDataText=function(e){this.setProperty("noDataText",e,true);var t=this.getAggregation("table");t.setNoDataText(e);return this};se.prototype.setLegend=function(e){this.setAssociation("legend",e,true);var t=this.getRows(),a=this.getLegend()&&m.byId(this.getLegend()),n;for(var s=0;s<t.length;s++){var r=t[s];Me(r).setLegend(e)}re.forEach(function(t){if(this[t]){this[t].setLegend(e)}},this);if(a){n=new i(function(e){this.invalidate()}.bind(this));n.observe(a,{destroy:true})}return this};se.prototype.addAriaLabelledBy=function(e){this.addAssociation("ariaLabelledBy",e,true);var t=this.getAggregation("table");t.addAriaLabelledBy(e);return this};se.prototype.removeAriaLabelledBy=function(e){this.removeAssociation("ariaLabelledBy",e,true);var t=this.getAggregation("table");t.removeAriaLabelledBy(e);return this};se.prototype.removeAllAriaLabelledBy=function(){this.removeAllAssociation("ariaLabelledBy",true);var e=this.getAggregation("table");e.removeAllAriaLabelledBy();e.addAriaLabelledBy(this.getId()+"-Descr");return this};se.prototype.invalidate=function(e){var a=e&&e instanceof p;if(!this._bIsBeingDestroyed&&(this._bDateRangeChanged||a)){if(this.getDomRef()){var i=this.getViewKey();var n=this._getView(i);var s=n.getIntervalType();switch(s){case ee.Hour:if(this._oTimesRow){this._oTimesRow.invalidate(arguments)}break;case ee.Day:if(this._oDatesRow){this._oDatesRow.invalidate(arguments)}break;case ee.Month:if(this._oMonthsRow){this._oMonthsRow.invalidate(arguments)}break;case ee.OneMonth:if(this._oOneMonthsRow){this._oOneMonthsRow.invalidate(arguments)}break;case ee.Week:if(this._oWeeksRow){this._oWeeksRow.invalidate(arguments)}break;default:throw new Error("Unknown IntervalType: "+s+"; "+this)}}this._bDateRangeChanged=undefined}else{if(e&&e instanceof sap.m.PlanningCalendarView){this._bCheckView=true}t.prototype.invalidate.apply(this,arguments)}};se.prototype.addSpecialDate=function(e){this._bDateRangeChanged=true;return t.prototype.addAggregation.call(this,"specialDates",e)};se.prototype.insertSpecialDate=function(e,a){this._bDateRangeChanged=true;return t.prototype.insertAggregation.call(this,"specialDates",e,a)};se.prototype.removeSpecialDate=function(e){this._bDateRangeChanged=true;return t.prototype.removeAggregation.call(this,"specialDates",e)};se.prototype.removeAllSpecialDates=function(){this._bDateRangeChanged=true;return this.removeAllAggregation("specialDates")};se.prototype.destroySpecialDates=function(){this._bDateRangeChanged=true;return this.destroyAggregation("specialDates")};se.prototype.removeAllViews=function(){this._bCheckView=true;var e=this.removeAllAggregation("views"),t=this.getBuiltInViews();if(t.length){this.setViewKey(t[0])}else{this.setViewKey(he[0])}return e};se.prototype.destroyViews=function(){this._bCheckView=true;var e=this.destroyAggregation("views"),t=this.getBuiltInViews();if(t.length){this.setViewKey(t[0])}else{this.setViewKey(he[0])}return e};se.prototype.getSelectedRows=function(){return this.getRows().filter(function(e){return e.getSelected()})};se.prototype.selectAllRows=function(e){var t=this.getRows();if(!(e&&this.getSingleSelection())){for(var a=0;a<t.length;a++){var i=t[a];i.setSelected(e)}if(this._oSelectAllCheckBox){this._oSelectAllCheckBox.setSelected(e)}}return this};se.prototype.onsaphomemodifiers=function(e){if((e.metaKey||e.ctrlKey)&&!e.altKey&&!e.shiftKey){var t=this.getRows();var a=t[0];var i=new Y.Event("saphome");i._bPlanningCalendar=true;Me(a).onsaphome(i);e.preventDefault();e.stopPropagation()}};se.prototype.onsapendmodifiers=function(e){if((e.metaKey||e.ctrlKey)&&!e.altKey&&!e.shiftKey){var t=this.getRows();var a=t[t.length-1];var i=new Y.Event("sapend");i._bPlanningCalendar=true;Me(a).onsapend(i);e.preventDefault();e.stopPropagation()}};se.prototype.setBuiltInViews=function(e){this.setProperty("builtInViews",e);this.setViewKey(this._getViews()[0].getKey());return this};se.prototype.removeView=function(e){var t=this.removeAggregation("views",e);if(!this.getViews().length){this.setViewKey(this._getViews()[0].getKey())}return t};se.prototype._getIntervals=function(e){var t=0;switch(this._iSize){case 0:t=e.getIntervalsS();break;case 1:t=e.getIntervalsM();break;default:t=e.getIntervalsL();break}return t};se.prototype._getView=function(e,t){var a=this._getViews();var i;for(var n=0;n<a.length;n++){i=a[n];if(i.getKey()!=e){i=undefined}else{break}}if(!i&&!t){throw new Error("PlanningCalendarView with key "+e+"not assigned "+this)}return i};se.prototype._changeStartDate=function(e){if(this._bNoStartDateChange){return}this.setStartDate(new Date(e.getTime()));this._updatePickerSelection();this.fireStartDateChange()};se.prototype._updateCurrentTimeVisualization=function(e){if(this._sUpdateCurrentTime){clearTimeout(this._sUpdateCurrentTime);this._sUpdateCurrentTime=undefined}if(e){var t=this.getRows();for(var a=0;a<t.length;a++){var i=t[a];Me(i).updateCurrentTimeVisualization()}}var n=new Date;var s=this.getStartDate();var r=this.getViewKey();var o=this._getView(r);var l=o.getIntervalType();var h=this._getIntervals(o);var g=0;var p=0;var d=0;switch(l){case ee.Hour:g=6e4;p=s.getTime()-36e5;d=s.getTime()+h*36e5;break;case ee.Day:case ee.Week:case ee.OneMonth:g=18e5;p=s.getTime()-36e5;d=s.getTime()+h*864e5;break;default:g=-1;break}if(n.getTime()<=d&&n.getTime()>=p&&g>0){this._sUpdateCurrentTime=setTimeout(this["_updateCurrentTimeVisualization"].bind(this,true),g)}};function ue(e){this.setViewKey(e.getParameter("item").getKey());this.fireViewChange()}se.prototype._handleTodayPress=function(e){var t=new Date,a,i=this.getViewKey();if(i===q.OneMonth){a=s.getFirstDateOfMonth(s._createUniversalUTCDate(t,undefined,true));this._adjustSelectedDate(r.fromLocalJSDate(t),false);t=s._createLocalDate(a,true)}if(i===q.Week){a=this.getStartDate();t.setHours(a.getHours());t.setMinutes(a.getMinutes());t.setSeconds(a.getSeconds())}this.setStartDate(t);this._dateNav.setCurrent(t);this._updatePickerSelection();this.fireStartDateChange()};se.prototype._handleStartDateChange=function(e){var t=e.oSource.getStartDate();if(this._getView(this.getViewKey()).getIntervalType()!==ee.Hour){var a=this.getStartDate();t.setHours(a.getHours());t.setMinutes(a.getMinutes());t.setSeconds(a.getSeconds())}this._changeStartDate(t)};se.prototype._handleDateSelect=function(e){var t=e.oSource.getStartDate();if(this._getView(this.getViewKey()).getIntervalType()===ee.Hour){var a=this.getStartDate();t.setHours(a.getHours());t.setMinutes(a.getMinutes());t.setSeconds(a.getSeconds())}this._changeStartDate(t);this._dateNav.setCurrent(t);var i=this.getViewKey(),n=this._getView(i),s=n.getIntervalType(),r,o=new Date(this._dateNav.getEnd().setHours(23,59,59));if(s==="Hour"){s="Time"}else if(s==="Day"){s="Date"}else if(s==="One Month"){s="OneMonth"}r="_o"+s+"sRow";if(this[r]){this[r].setDate(t)}if(t>this.getMinDate()&&t<this.getMaxDate()){this._getHeader()._oNextBtn.setEnabled(true);this._getHeader()._oPrevBtn.setEnabled(true)}else if(this.getMinDate()>=this._dateNav.getStart()&&this.getMinDate()<=o){this._getHeader()._oPrevBtn.setEnabled(false)}else if(this.getMaxDate()>=this._dateNav.getStart()&&this.getMaxDate()<=o){this._getHeader()._oNextBtn.setEnabled(false)}};se.prototype._handleCalendarSelect=function(e){var t=e.getSource().getSelectedDates();if(!t.length){return}var a=new Date(t[0].getStartDate());var i=s._createUniversalUTCDate(a,undefined,true);var n=this.getViewKey();var o=this._getView(n);var l=o.getIntervalType();if(l!==ee.OneMonth||this._iSize>1){t[0].setStartDate()}switch(l){case ee.Hour:i.setUTCHours(i.getUTCHours()+1);break;case ee.Day:case ee.Week:i.setUTCDate(i.getUTCDate()+1);break;case ee.OneMonth:if(this._iSize<2){var h=new Date(a.getTime());if(s.monthsDiffer(this.getStartDate(),a)){this.setStartDate(a);this._getHeader().setPickerText(this._formatPickerText())}this._setRowsStartDate(h);this._oOneMonthsRow._focusDate(r.fromLocalJSDate(h),true)}else if(s._isNextMonth(a,this.getStartDate())){this.shiftToDate(a);return}i.setUTCDate(i.getUTCDate()+1);break;case ee.Month:i.setUTCMonth(i.getUTCMonth()+1);break;default:throw new Error("Unknown IntervalType: "+l+"; "+this)}i.setUTCMilliseconds(i.getUTCMilliseconds()-1);i=s._createLocalDate(i,true);this._formatPickerText();this.fireIntervalSelect({startDate:a,endDate:i,subInterval:false,row:undefined})};function ce(e){var t=e.getParameter("startDate");var a=this.getViewKey();var i=this._getView(a);var n=i.getIntervalType();if(n===ee.OneMonth&&s._isNextMonth(t,this.getStartDate())){this.shiftToDate(t);return}var r=e.getParameter("endDate");var o=e.getParameter("subInterval");var l=Re(e.oSource.getParent());this._formatPickerText();this.fireIntervalSelect({startDate:t,endDate:r,subInterval:o,row:l})}se.prototype._applyContextualSettings=function(e){return t.prototype._applyContextualSettings.call(this,e||a._defaultContextualSettings)};function fe(e,t){this.$().toggleClass("sapMPlanCalWithWeekNumbers",e&&t)}function me(e,t){this.$().toggleClass("sapMPlanCalWithDayNamesLine",e&&t)}function _e(e,t){if(e.size.width<=0){return}if(Math.abs(this.iWidth-e.size.width)<15){return}this.iWidth=e.size.width;this._applyContextualSettings({contextualWidth:this.iWidth});var a=this.getRows();var i;var n=0;var s=this._iSize;ke.call(this,e.size.width);if(s!=this._iSize){Pe.call(this,this._iSize);var o=this.getViewKey();var l=this._getView(o);var h=l.getIntervalType();var g=this._getIntervals(l);for(n=0;n<a.length;n++){i=a[n];var p=Me(i);if(g!=p.getIntervals()){p.setIntervals(g)}else{p.handleResize()}}switch(h){case ee.Hour:if(this._oTimesRow&&this._oTimesRow.getItems()!=g){this._oTimesRow.setItems(g);this._dateNav.setStep(g)}break;case ee.Day:if(this._oDatesRow&&this._oDatesRow.getDays()!=g){this._oDatesRow.setDays(g);this._dateNav.setStep(g)}break;case ee.Month:if(this._oMonthsRow&&this._oMonthsRow.getMonths()!=g){this._oMonthsRow.setMonths(g);this._dateNav.setStep(g)}break;case ee.Week:if(this._oWeeksRow&&this._oWeeksRow.getDays()!=g){this._oWeeksRow.setDays(g);this._dateNav.setStep(g)}break;case ee.OneMonth:if(this._oOneMonthsRow&&this._oOneMonthsRow.getDays()!=g){this._oOneMonthsRow.setDays(g);this._dateNav.setStep(g);if(this._iSize>1){this._setRowsStartDate(new Date(this.getStartDate().getTime()))}}break;default:throw new Error("Unknown IntervalType: "+h+"; "+this)}Ee.call(this)}else if(!t){for(n=0;n<a.length;n++){i=a[n];Me(i).handleResize()}}if(this._oOneMonthsRow){this._oOneMonthsRow.setMode(this._iSize);this._adjustSelectedDate(r.fromLocalJSDate(this.getStartDate()))}if(this.getStickyHeader()){this._updateStickyHeader()}}function De(e){var t=e.getParameter("appointment"),a=e.getParameter("multiSelect"),i=e.getParameter("appointments"),n=e.getParameter("domRefId"),s,r,o,l,h,g,p;if(!a){r=this.getRows();for(g=0;g<r.length;g++){o=r[g];if(e.oSource!=Me(o)){l=o.getAppointments();for(p=0;p<l.length;p++){h=l[p];h.setSelected(false)}}}}s={appointment:t,appointments:i,multiSelect:a,domRefId:n};this.fireAppointmentSelect(s)}se.prototype._setRowsStartDate=function(e){var t=this.getRows(),a,i;for(i=0;i<t.length;i++){a=t[i];Me(a).setStartDate(e)}};se.prototype._toggleAppointmentsColumnPopinState=function(e){var t=this.getAggregation("table"),a=t.getColumns()[1];a.setDemandPopin(e);a.setMinScreenWidth(e?le:"")};se.prototype._getViews=function(){var e=this.getViews(),t=this.getBuiltInViews(),a,i=[],n=q,s=ee;if(!this._oViews){this._oViews={}}if(t.length){i=t}else{i=e.length?[]:he}a=i.map(function(e){switch(e){case n.Hour:return this._oViews[n.Hour]||(this._oViews[n.Hour]=new z(this.getId()+"-HourView",{key:n.Hour,intervalType:s.Hour,description:this._oRB&&this._oRB.getText("PLANNINGCALENDAR_HOURS"),intervalsS:6,intervalsM:6,intervalsL:12}));case n.Day:return this._oViews[n.Day]||(this._oViews[n.Day]=new z(this.getId()+"-DayView",{key:n.Day,intervalType:s.Day,description:this._oRB&&this._oRB.getText("PLANNINGCALENDAR_DAYS"),intervalsS:7,intervalsM:7,intervalsL:14}));case n.Month:return this._oViews[n.Month]||(this._oViews[n.Month]=new z(this.getId()+"-MonthView",{key:n.Month,intervalType:s.Month,description:this._oRB&&this._oRB.getText("PLANNINGCALENDAR_MONTHS"),intervalsS:3,intervalsM:6,intervalsL:12}));case n.Week:return this._oViews[n.Week]||(this._oViews[n.Week]=new z(this.getId()+"-WeekView",{key:n.Week,intervalType:s.Week,description:this._oRB&&this._oRB.getText("PLANNINGCALENDAR_WEEK"),intervalsS:7,intervalsM:7,intervalsL:7}));case n.OneMonth:return this._oViews[n.OneMonth]||(this._oViews[n.OneMonth]=new z(this.getId()+"-OneMonthView",{key:n.OneMonth,intervalType:s.OneMonth,description:this._oRB&&this._oRB.getText("PLANNINGCALENDAR_ONE_MONTH"),intervalsS:1,intervalsM:1,intervalsL:31}));default:F.error("Cannot get PlanningCalendar views. Invalid view key "+e);break}},this);for(var r in this._oViews){if(i.indexOf(r)<0){this._oViews[r].destroy();delete this._oViews[r]}}if(e.length){a=a.concat(e)}return a};se.prototype.getSelectedAppointments=function(){var e=[];this.getRows().filter(function(t){e.push.apply(e,Me(t).aSelectedAppointments)});return e};se.prototype.setCustomAppointmentsSorterCallback=function(e){if(typeof e==="function"||e===null||e===undefined){this.getRows().forEach(function(t){Me(t)._setCustomAppointmentsSorterCallback(e)});this._fnCustomSortedAppointments=e}else{F.warning("Your custom sort function won't be used, but the old one will be preserved.",this)}return this};se.prototype.getCustomAppointmentsSorterCallback=function(){return this._fnCustomSortedAppointments};se.prototype._onRowDeselectAppointment=function(){var e=this.getRows();for(var t=0;t<e.length;t++){var a=Me(e[t]).aSelectedAppointments;for(var i=0;i<a.length;i++){var n=m.byId(a[i]);if(n){n.setProperty("selected",false,true);n.$().removeClass("sapUiCalendarAppSel")}}Me(e[t]).aSelectedAppointments=[]}};se.prototype._updateRowTimeline=function(e){var t=Me(e),a,i,n,s,r=this.getViewKey()===q.OneMonth&&this._iSize<2,o=this.getStartDate();t.setNonWorkingDays(e.getNonWorkingDays());t.setNonWorkingHours(e.getNonWorkingHours());if(r&&this._oOneMonthsRow&&this._oOneMonthsRow.getSelectedDates().length){o=this._oOneMonthsRow.getSelectedDates()[0].getStartDate()}t.setStartDate(o);t.setShowIntervalHeaders(this.getShowIntervalHeaders());t.setShowEmptyIntervalHeaders(this.getShowEmptyIntervalHeaders());t.setGroupAppointmentsMode(this.getGroupAppointmentsMode());t.setAppointmentsReducedHeight(this.getAppointmentsReducedHeight());t.setLegend(this.getLegend());t.setAppointmentsVisualization(this.getAppointmentsVisualization());t.attachEvent("select",De,this);t.attachEvent("startDateChange",this._handleStartDateChange,this);t.attachEvent("leaveRow",Ve,this);t.attachEvent("intervalSelect",ce,this);Oe.call(this);if(Le.call(this)){a=this.getViewKey();i=this._getView(a);n=i.getIntervalType();s=this._getIntervals(i);t.setIntervalType(n);t.setIntervals(s);t.setShowSubIntervals(i.getShowSubIntervals())}xe.call(this);if(this._fnCustomSortedAppointments){t._setCustomAppointmentsSorterCallback(this._fnCustomSortedAppointments)}};se.prototype._observeRowChanges=function(e){var t=Ae(e),a=be(e),n=Me(e);var s={destroy:function(){t.destroy()},change:{title:function(e){a.setProperty(e.name,e.current)},icon:function(e){a.setProperty(e.name,e.current)},text:function(e){n.toggleStyleClass("sapMPlanCalRowLarge",!!e.current);a.setProperty("description",e.current)},enableAppointmentsDragAndDrop:function(t){this._enableAppointmentsDragAndDrop(e)}.bind(this),enableAppointmentsResize:function(t){this._enableAppointmentsResize(e)}.bind(this),enableAppointmentsCreate:function(t){this._enableAppointmentsCreate(e)}.bind(this),nonWorkingDays:function(e){n.setProperty(e.name,e.current)},nonWorkingHours:function(e){n.setProperty(e.name,e.current)},selected:function(e){Oe.call(this);t.setProperty(e.name,e.current)}.bind(this),tooltip:function(e){if(e.mutation==="insert"){a.setTooltip(e.child)}else if(e.mutation==="remove"){a.setTooltip()}},intervalHeaders:function(e){n.invalidate()},appointments:function(e){n.invalidate()}}};new i(function(e){if(e.type==="destroy"){s.destroy()}else if(s.change[e.name]){s.change[e.name](e)}}).observe(e,{properties:["icon","text","title","nonWorkingDays","nonWorkingHours","selected","enableAppointmentsDragAndDrop","enableAppointmentsResize","enableAppointmentsCreate"],aggregations:["tooltip","appointments","intervalHeaders","headerContent"],destroy:true});e.invalidate=function(e){if(!e||!(e instanceof d)){_.prototype.invalidate.apply(this,arguments)}else if(t){n.invalidate(e)}};e.applyFocusInfo=function(e){n.applyFocusInfo(e);return this}};se.prototype._createPlanningCalendarListItem=function(e){var t,a,i;if(e.getHeaderContent().length||e.getBindingInfo("headerContent")){a=e._getPlanningCalendarCustomRowHeader()}else{a=new we(e.getId()+"-Head",{icon:e.getIcon(),description:e.getText(),title:e.getTitle(),tooltip:e.getTooltip()})}i=new ye(e.getId()+"-CalRow",{checkResize:false,updateCurrentTime:false,ariaLabelledBy:a.getId()});i.getAppointments=function(){return e.getAppointments()};i.getIntervalHeaders=function(){return e.getIntervalHeaders()};t=new Ce(e.getId()+ne,{cells:[a,i]});this._updateRowTimeline(e);this._observeRowChanges(e);this._enableAppointmentsDragAndDrop(e);this._enableAppointmentsResize(e);this._enableAppointmentsCreate(e);return t};se.prototype._handleRowRemoval=function(e){var t=Me(e);t.detachEvent("select",De,this);t.detachEvent("startDateChange",this._handleStartDateChange,this);t.detachEvent("leaveRow",Ve,this);t.detachEvent("intervalSelect",ce,this);if(this._fnCustomSortedAppointments){t._fnCustomSortedAppointments=undefined}Ae(e).destroy()};var we=O.extend("PlanningCalendarRowHeader",{renderer:D.extend(E),TagName:"div"});we.prototype.isSelectable=function(){return false};PlanningCalendarRowHeaderRenderer.renderTabIndex=function(e,t){};PlanningCalendarRowHeaderRenderer.getAriaRole=function(e,t){};var ve=D.extend(c);ve.apiVersion=2;ve.getLegendItems=function(e){var t=[],a,i=e.getLegend();if(i){a=m.byId(i);if(a){t=a.getAppointmentItems?a.getAppointmentItems():a.getItems()}else{F.error("PlanningCalendarLegend with id '"+i+"' does not exist!",e)}}return t};ve.renderBeforeAppointments=function(e,t){var a=Re(t.getParent()),i;if(!a.getEnableAppointmentsDragAndDrop()&&!a.getEnableAppointmentsResize()&&!a.getEnableAppointmentsCreate()||t._isOneMonthsRowOnSmallSizes()){return}i=t.getAggregation("_intervalPlaceholders");e.openStart("div");e.class("sapUiCalendarRowAppsOverlay");e.openEnd();if(i){for(var n=0;n<i.length;n++){var s=i[n];s.setWidth(100/i.length+"%");e.renderControl(s)}}e.close("div")};ve.renderResizeHandle=function(e,t,a){if(!Re(t.getParent()).getEnableAppointmentsResize()||t._isOneMonthsRowOnSmallSizes()||a._aAppointments&&a._aAppointments.length>0){return}e.openStart("span");e.class("sapUiCalendarAppResizeHandle");e.openEnd();e.close("span")};ve.writeCustomAttributes=function(e,t){if(Re(t.getParent()).getEnableAppointmentsCreate()){e.attr("draggable","true")}};ve.renderInterval=function(e,t,a,i,n,s,r,o,l,h,g,p,d){var u=t.getIntervalType();if(u===ee.Day||u===ee.Week||u===ee.OneMonth){var f=Re(t.getParent()),m=f.getParent(),_=function(e){return e.getType()===j.NonWorking},D=f.getSpecialDates().filter(_),w=m.getSpecialDates().filter(_),v=t.getStartDate(),y,S,C,T;if(w&&D){y=w.concat(D)}else if(D){y=D}if(y&&y.length){var R=function(e){return e===S.getDay()};S=new Date(v.getTime());S.setHours(0,0,0);S.setDate(v.getDate()+a);for(var A=0;A<y.length;A++){if(y[A].getStartDate()){C=new Date(y[A].getStartDate().getTime())}if(y[A].getEndDate()){T=new Date(y[A].getEndDate().getTime())}else{T=new Date(y[A].getStartDate().getTime());T.setHours(23,59,59)}if(S.getTime()>=C.getTime()&&S.getTime()<=T.getTime()){var b=s.some(R);if(!b){e.class("sapUiCalendarRowAppsNoWork")}}}}}c.renderInterval(e,t,a,i,n,s,r,o,l,h,g,p,d)};var ye=u.extend("PlanningCalendarRowTimeline",{metadata:{aggregations:{intervalHeaders:{type:"sap.ui.unified.CalendarAppointment",multiple:true},_intervalPlaceholders:{type:"IntervalPlaceholder",multiple:true,visibility:"hidden",dnd:{droppable:true}}},dnd:true},renderer:ve});ye.prototype._updatePlaceholders=function(){var e=this.getProperty("intervals");if(this.getIntervalType()===ee.Hour){e*=2}this.removeAllAggregation("_intervalPlaceholders");for(var t=0;t<e;t++){this.addAggregation("_intervalPlaceholders",new Se)}};ye.prototype.onBeforeRendering=function(){u.prototype.onBeforeRendering.call(this);this._updatePlaceholders()};ye.prototype.onmousedown=function(e){var t=e.target.classList;this._isResizeHandleMouseDownTarget=t.contains("sapUiCalendarAppResizeHandle");this._isRowAppsIntervalMouseDownTarget=t.contains("sapUiCalendarRowAppsInt")};ye.prototype._isResizingPerformed=function(){return this._isResizeHandleMouseDownTarget};ye.prototype._isDraggingPerformed=function(){return!this._isResizeHandleMouseDownTarget&&!this._isRowAppsIntervalMouseDownTarget};ye.prototype._isCreatingPerformed=function(){return this._isRowAppsIntervalMouseDownTarget};var Se=t.extend("IntervalPlaceholder",{metadata:{properties:{width:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:null}}},renderer:function(e,t){e.openStart("div",t);e.style("width",t.getWidth());e.class("sapUiCalendarRowAppsPlaceholder");e.openEnd();e.close("div")}});var Ce=H.extend("sap.m.internal.PlanningCalendarRowListItem",{metadata:{library:"sap.m"},renderer:N});Ce.prototype.getHeader=function(){return this.getCells()[0]};Ce.prototype.getTimeline=function(){return this.getCells()[1]};Ce.prototype.getCustomData=function(){return Re(this).getCustomData()};se.prototype._getSelectedDates=function(){var e=this.getViewKey(),t=this._getView(e),a=t.getIntervalType(),i=oe[a];return this[i.sInstanceName].getSelectedDates()};se.prototype._enableAppointmentsDragAndDrop=function(e){var t=Me(e),a;if(e.getEnableAppointmentsDragAndDrop()){a=e.getDragDropConfig().some(function(e){return e.getGroupName()===te});if(!a){this._addDragDropInfo(e,Me(e))}}else{e.getDragDropConfig().forEach(function(t){if(t.getGroupName()===te){e.removeDragDropConfig(t)}});t.getDragDropConfig().forEach(function(e){if(e.getGroupName()===te){t.removeDragDropConfig(e)}})}};se.prototype._enableAppointmentsResize=function(e){var t=e.getEnableAppointmentsResize(),a=this._getConfigFromDragDropConfigAggregation(e.getAggregation("dragDropConfig"),ae),i=this._getResizeConfig(e);if(t&&!a){e.addAggregation("dragDropConfig",i,true)}if(!t){e.removeAggregation("dragDropConfig",a,true)}};se.prototype._enableAppointmentsCreate=function(e){var t=e.getEnableAppointmentsCreate(),a=Me(e),i=this._getConfigFromDragDropConfigAggregation(a.getAggregation("dragDropConfig"),ie),n=this._getAppointmentsCreateConfig(e);if(t&&!i){a.addAggregation("dragDropConfig",n,true)}if(!t){a.removeAggregation("dragDropConfig",i,true)}};se.prototype._addDragDropInfo=function(e,t){e.addDragDropConfig(new S({groupName:te,sourceAggregation:"appointments",dragStart:function(e){var a=function(){var e=Y(".sapUiCalendarRowAppsOverlay");setTimeout(function(){e.addClass("sapUiCalendarRowAppsOverlayDragging")},0);Y(document).one("dragend",function(){e.removeClass("sapUiCalendarRowAppsOverlayDragging")})};if(t._isOneMonthsRowOnSmallSizes()||!t._isDraggingPerformed()){e.preventDefault();return}a()}}));t.addDragDropConfig(new C({groupName:te,targetAggregation:"_intervalPlaceholders",dragEnter:function(a){var i=a.getParameter("dragSession"),n=i.getDragControl(),s=t.getIntervalType(),r=t.getStartDate(),o=t.indexOfAggregation("_intervalPlaceholders",i.getDropControl()),l=t.getId(),h,g=function(){var e=Y(i.getIndicator()),t=i.getDropControl().getDomRef().getBoundingClientRect(),a=m.byId(l).getDomRef().getBoundingClientRect(),n=i.getDragControl().$().outerWidth(),s=m.getConfiguration().getRTL(),r=s?Math.ceil(t.right)-a.left:a.right-Math.ceil(t.left);e.css("min-width",n<r?n:r).css(s?"border-left-width":"border-right-width",n>r?"0":"").css("margin-left",s?-(e.outerWidth()-parseFloat(e.context.style.width)):"")};if(e.hasListeners("appointmentDragEnter")){if(s===ee.Hour){h=this._calcNewHoursAppPos(r,n.getStartDate(),n.getEndDate(),o)}else if(s===ee.Day||s===ee.Week||s===ee.OneMonth&&!t._isOneMonthsRowOnSmallSizes()){h=this._calcNewDaysAppPos(r,n.getStartDate(),n.getEndDate(),o)}else if(s===ee.Month){h=this._calcNewMonthsAppPos(r,n.getStartDate(),n.getEndDate(),o)}var p=e.fireAppointmentDragEnter({appointment:n,startDate:h.startDate,endDate:h.endDate,calendarRow:Re(t.getParent())});if(!p){a.preventDefault();return}}else if(Me(n.getParent())!==t){a.preventDefault();return}if(t.getIntervalType()!==ee.Hour){return}if(!i.getIndicator()){setTimeout(g,0)}else{g()}}.bind(this),drop:function(a){var i=a.getParameter("dragSession"),n=i.getDragControl(),s=t.getIntervalType(),r=t.getStartDate(),o=t.indexOfAggregation("_intervalPlaceholders",i.getDropControl()),l,h=a.getParameter("browserEvent"),g=h.metaKey||h.ctrlKey;if(s===ee.Hour){l=this._calcNewHoursAppPos(r,n.getStartDate(),n.getEndDate(),o)}else if(s===ee.Day||s===ee.Week||s===ee.OneMonth&&!t._isOneMonthsRowOnSmallSizes()){l=this._calcNewDaysAppPos(r,n.getStartDate(),n.getEndDate(),o)}else if(s===ee.Month){l=this._calcNewMonthsAppPos(r,n.getStartDate(),n.getEndDate(),o)}t.$().find(".sapUiCalendarRowAppsOverlay").removeClass("sapUiCalendarRowAppsOverlayDragging");if(n.getStartDate().getTime()===l.startDate.getTime()&&n.getParent()===Re(t.getParent())){return}e.fireAppointmentDrop({appointment:n,startDate:l.startDate,endDate:l.endDate,calendarRow:Re(t.getParent()),copy:g})}.bind(this)}))};se.prototype._calcNewHoursAppPos=function(e,t,a,i){var n=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());n=new Date(n.getTime()+i*30*60*1e3);return{startDate:n,endDate:new Date(n.getTime()+a.getTime()-t.getTime())}};se.prototype._calcNewDaysAppPos=function(e,t,a,i){var n=new Date(e);n.setDate(n.getDate()+i);n=new Date(n.getFullYear(),n.getMonth(),n.getDate(),t.getHours(),t.getMinutes(),t.getSeconds());return{startDate:n,endDate:new Date(n.getTime()+a.getTime()-t.getTime())}};se.prototype._calcNewMonthsAppPos=function(e,t,a,i){var n=new Date(e);n.setMonth(n.getMonth()+i);n=new Date(n.getFullYear(),n.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds());return{startDate:n,endDate:new Date(n.getTime()+a.getTime()-t.getTime())}};se.prototype._getResizeConfig=function(e){var t=Me(e),a=new T({sourceAggregation:"appointments",targetAggregation:"_intervalPlaceholders",targetElement:Me(e),dragStart:function(a){if(!e.getEnableAppointmentsResize()||t._isOneMonthsRowOnSmallSizes()||!t._isResizingPerformed()){a.preventDefault();return}var i=a.getParameter("dragSession"),n=t.$().find(".sapUiCalendarRowAppsOverlay"),s=Y(i.getIndicator()),r=i.getDragControl().$();s.addClass("sapUiDnDIndicatorHide");setTimeout(function(){n.addClass("sapUiCalendarRowAppsOverlayDragging")},0);Y(document).one("dragend",function(){n.removeClass("sapUiCalendarRowAppsOverlayDragging");s.removeClass("sapUiDnDIndicatorHide");r.css({width:"auto","min-width":"auto","z-index":"auto",opacity:1})});if(!f.browser.msie&&!f.browser.edge){a.getParameter("browserEvent").dataTransfer.setDragImage(Te(),0,0)}},dragEnter:function(e){var t=e.getParameter("dragSession"),a=this.getTargetElement(),i=function(){var e=Y(t.getIndicator());e.addClass("sapUiDnDIndicatorHide")},n=t.getDropControl().getDomRef().getBoundingClientRect(),s=m.byId(a).getDomRef().getBoundingClientRect(),r={width:n.left+n.width-(t.getDragControl().$().position().left+s.left),"z-index":1,opacity:.8},o=r.width;if(n.width>0){while(o<=0){o+=n.width}while(o>n.width){o-=n.width}}r["min-width"]=o;t.getDragControl().$().css(r);if(!t.getIndicator()){setTimeout(i,0)}else{i()}},drop:function(t){var a=Me(e),i=t.getParameter("dragSession"),n=i.getDragControl(),s=a.getIntervalType(),r=a.getStartDate(),o=a.indexOfAggregation("_intervalPlaceholders",i.getDropControl()),l;if(s===ee.Hour){l=this._calcResizeNewHoursAppPos(r,n.getStartDate(),n.getEndDate(),o)}else if(s===ee.Day||s===ee.Week||s===ee.OneMonth&&!a._isOneMonthsRowOnSmallSizes()){l=this._calcResizeNewDaysAppPos(r,n.getStartDate(),n.getEndDate(),o)}else if(s===ee.Month){l=this._calcResizeNewMonthsAppPos(r,n.getStartDate(),n.getEndDate(),o)}a.$().find(".sapUiCalendarRowAppsOverlay").removeClass("sapUiCalendarRowAppsOverlayDragging");Y(i.getIndicator()).removeClass("sapUiDnDIndicatorHide");n.$().css({width:"auto","min-width":"auto","z-index":"auto",opacity:1});if(n.getEndDate().getTime()===l.endDate.getTime()){return}e.fireAppointmentResize({appointment:n,startDate:l.startDate,endDate:l.endDate,calendarRow:e})}.bind(this)});a.setProperty("groupName",ae);return a};se.prototype._calcResizeNewHoursAppPos=function(e,t,a,i){var n=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours()),s=30*60*1e3;n=new Date(n.getTime()+(i+1)*s);if(n.getTime()<=t.getTime()){n=new Date(t.getTime()+s)}return{startDate:t,endDate:n}};se.prototype._calcResizeNewDaysAppPos=function(e,t,a,i){var n=new Date(e),s=n.getDate()+i+1,r=new Date(n.getFullYear(),n.getMonth(),n.getDate());r.setDate(s);if(r.getTime()<=t.getTime()){s=t.getDate()+1}n.setDate(s);n=new Date(n.getFullYear(),n.getMonth(),n.getDate());return{startDate:t,endDate:n}};se.prototype._calcResizeNewMonthsAppPos=function(e,t,a,i){var n=new Date(e),s=n.getMonth()+i+1;if(s<=t.getMonth()){s=t.getMonth()+1}n.setMonth(s);n=new Date(n.getFullYear(),n.getMonth(),1);return{startDate:t,endDate:n}};se.prototype._calcCreateNewAppHours=function(e,t,a){var i=30*60*1e3,n,s;if(t<=a){n=new Date(e.getTime()+t*i);s=new Date(e.getTime()+(a+1)*i)}else{n=new Date(e.getTime()+a*i);s=new Date(e.getTime()+t*i)}return{startDate:n,endDate:s}};se.prototype._calcCreateNewAppDays=function(e,t,a){var i=new Date(e),n=new Date(e);if(t<=a){i=new Date(e.getFullYear(),e.getMonth(),e.getDate()+t);n=new Date(e.getFullYear(),e.getMonth(),e.getDate()+a+1)}else{i=new Date(e.getFullYear(),e.getMonth(),e.getDate()+a);n=new Date(e.getFullYear(),e.getMonth(),e.getDate()+t)}return{startDate:i,endDate:n}};se.prototype._calcCreateNewAppMonths=function(e,t,a){var i=new Date(e),n=new Date(e);if(t<=a){i=new Date(e.getFullYear(),e.getMonth()+t,1);n=new Date(e.getFullYear(),e.getMonth()+a+1,1)}else{i=new Date(e.getFullYear(),e.getMonth()+a,1);n=new Date(e.getFullYear(),e.getMonth()+t,1)}return{startDate:i,endDate:n}};se.prototype._getConfigFromDragDropConfigAggregation=function(e,t){var a=e,i=a&&a.length;for(var n=0;n<i;n++){if(a[n].getGroupName()===t){return a[n]}}return null};se.prototype._getAppointmentsCreateConfig=function(e){var t=Me(e),a=new T({targetAggregation:"_intervalPlaceholders",dragStart:function(a){if(!e.getEnableAppointmentsCreate()||t._isOneMonthsRowOnSmallSizes()||!t._isCreatingPerformed()){a.preventDefault();return}var i=a.getParameter("dragSession"),n=t.$().find(".sapUiCalendarRowAppsOverlay"),s=Y(i.getIndicator());setTimeout(function(){n.addClass("sapUiCalendarRowAppsOverlayDragging")},0);Y(document).one("dragend",function(){n.removeClass("sapUiCalendarRowAppsOverlayDragging");s.html("");s.removeClass("sapUiCalendarApp sapUiCalendarAppType01 sapUiAppCreate")});if(!f.browser.msie&&!f.browser.edge){a.getParameter("browserEvent").dataTransfer.setDragImage(Te(),0,0)}},dragEnter:function(e){var a=e.getParameter("dragSession"),i=a.getDropControl().getDomRef().getBoundingClientRect(),n=function(){var e=Y(a.getIndicator());e.addClass("sapUiCalendarApp sapUiCalendarAppType01 sapUiAppCreate")};var s=a.getData("text")?parseFloat(a.getData("text").split("|")[0]):0;if(s){if(s<=i.left){a.setIndicatorConfig({left:s,width:Math.max(i.left+i.width-s,i.width)})}else{a.setIndicatorConfig({left:i.left,width:s-i.left})}}else{a.setData("text",i.left+"|"+t.indexOfAggregation("_intervalPlaceholders",a.getDropControl()))}if(!a.getIndicator()){setTimeout(n,0)}else{n()}},drop:function(a){var i=a.getParameter("dragSession"),n=Y(i.getIndicator()),s=t.getIntervalType(),r=Me(e).getStartDate(),o=parseInt(i.getData("text").split("|")[1]),l=t.indexOfAggregation("_intervalPlaceholders",i.getDropControl()),h;if(s===ee.Hour){h=this._calcCreateNewAppHours(r,o,l)}else if(s===ee.Day||s===ee.Week||s===ee.OneMonth&&!t._isOneMonthsRowOnSmallSizes()){h=this._calcCreateNewAppDays(r,o,l)}else if(s===ee.Month){h=this._calcCreateNewAppMonths(r,o,l)}e.fireAppointmentCreate({startDate:h.startDate,endDate:h.endDate,calendarRow:e});n.html("");n.removeClass("sapUiCalendarApp sapUiCalendarAppType01 sapUiAppCreate")}.bind(this)});a.setProperty("groupName",ie);return a};function Te(){var e=Y("<span></span>").addClass("sapUiCalAppResizeGhost");e.appendTo(document.body);setTimeout(function(){e.remove()},0);return e.get(0)}function Re(e){var t=e.getId();return m.byId(t.substring(0,t.indexOf(ne)))}function Ae(e){return m.byId(e.getId()+ne)}function be(e){var t=Ae(e);return t?t.getHeader():null}function Me(e){var t=Ae(e);return t?t.getTimeline():null}function Ie(e){var t=[];var a=this.getRows();for(var i=0;i<a.length;i++){var n=a[i];var s=Ae(n);var r=s.getSelected();if(n.getSelected()!=r){n.setProperty("selected",r,true);t.push(n)}}if(!this.getSingleSelection()){Oe.call(this)}if(t.length>0){this.fireRowSelectionChange({rows:t})}}function ke(e){if(e<this._iBreakPointTablet){this._iSize=0}else if(e<this._iBreakPointDesktop){this._iSize=1}else{this._iSize=2}if(e<ge.PHONE){this._iSizeScreen=0}else if(e<ge.TABLET){this._iSizeScreen=1}else{this._iSizeScreen=2}}function Pe(e){var t="sapMSize"+e,a,i;for(a=0;a<3;a++){i="sapMSize"+a;if(i===t){this.addStyleClass(i)}else{this.removeStyleClass(i)}}}function He(){var e=this._getViews();this._oIntervalTypeSelect.destroyItems();var t;var a;for(t=0;t<e.length;t++){var i=e[t];a=new V(this.getId()+"-"+t,{key:i.getKey(),text:i.getDescription(),tooltip:i.getTooltip()});this._oIntervalTypeSelect.addItem(a)}if(this._oIntervalTypeSelect.getItems().length>4){this._getHeader()._convertViewSwitchToSelect()}else{this._getHeader()._convertViewSwitchToSegmentedButton()}this._oIntervalTypeSelect.setVisible(!(e.length===1))}function Ne(e){var t=e.getParameter("selected");var a=this.getRows();if(t){a=this.getRows().filter(function(e){return!e.getSelected()})}this.selectAllRows(t);this.fireRowSelectionChange({rows:a})}function Ve(e){var t=e.oSource;var a=e.getParameter("type");var i=this.getRows();var n;var s;var r;var o;var l=0;var h=0;var g;for(l=0;l<i.length;l++){n=i[l];if(Me(n)==t){h=l;break}}switch(a){case"sapup":r=t.getFocusedAppointment();o=r.getStartDate();if(h>0){h--}s=i[h];Me(s).focusNearestAppointment(o);break;case"sapdown":r=t.getFocusedAppointment();o=r.getStartDate();if(h<i.length-1){h++}s=i[h];Me(s).focusNearestAppointment(o);break;case"saphome":if(h>0){s=i[0];g=new Y.Event(a);g._bPlanningCalendar=true;Me(s).onsaphome(g)}break;case"sapend":if(h<i.length-1){s=i[i.length-1];g=new Y.Event(a);g._bPlanningCalendar=true;Me(s).onsapend(g)}break;default:break}}function Oe(){if(this._oSelectAllCheckBox){var e=this.getRows();var t=this.getSelectedRows();if(e.length==t.length&&t.length>0){this._oSelectAllCheckBox.setSelected(true)}else{this._oSelectAllCheckBox.setSelected(false)}}}function Ee(){if(this.getSingleSelection()){if(this._oCalendarHeader.getAllCheckBox()){this._oCalendarHeader.setAllCheckBox()}else if(this._oInfoToolbar.getContent().length>2){this._oInfoToolbar.removeContent(this._oSelectAllCheckBox)}}else{if(!this._oSelectAllCheckBox){this._oSelectAllCheckBox=new U(this.getId()+"-All",{text:this._oRB.getText("COLUMNSPANEL_SELECT_ALL")});this._oSelectAllCheckBox.attachEvent("select",Ne,this)}if(this._iSizeScreen<2||!this.getShowRowHeaders()){var e=this._oInfoToolbar.indexOfContent(this._oSelectAllCheckBox);if(this._iSizeScreen<2){if(e<this._oInfoToolbar.getContent().length-1){this._oInfoToolbar.addContent(this._oSelectAllCheckBox)}}else if(e<0||e>1){if(e>1){this._oInfoToolbar.removeContent(this._oSelectAllCheckBox)}this._oInfoToolbar.insertContent(this._oSelectAllCheckBox,1)}}else{this._oCalendarHeader.setAllCheckBox(this._oSelectAllCheckBox)}}}function xe(){var e=this.getAggregation("table");var t=e.getMode();var a;if(this.getSingleSelection()){if(!this.getShowRowHeaders()&&this.getRows().length==1){a=$.None}else{a=$.SingleSelectMaster}}else{a=$.MultiSelect}if(t!=a){e.setMode(a)}}function Le(){return this._oTimesRow||this._oDatesRow||this._oMonthsRow||this._oWeeksRow||this._oOneMonthsRow}return se});